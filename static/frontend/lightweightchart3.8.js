
/*!
 * @license
 * TradingView Lightweight Charts v3.4.0-dev+202102171116
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function n(t,i){var n,h=((n={})[0]=[],n[1]=[t.lineWidth,t.lineWidth],n[2]=[2*t.lineWidth,2*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(h)}function h(t,i,n,h){t.beginPath();var s=t.lineWidth%2?.5:0;t.moveTo(n,i+s),t.lineTo(h,i+s),t.stroke()}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));var s=function(t,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])})(t,i)};function r(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}s(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var i,n=1,h=arguments.length;n<h;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};function e(){for(var t=0,i=0,n=arguments.length;i<n;i++)t+=arguments[i].length;var h=Array(t),s=0;for(i=0;i<n;i++)for(var r=arguments[i],u=0,e=r.length;u<e;u++,s++)h[s]=r[u];return h}function o(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function a(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function l(t){return f(a(t))}function c(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var h=0,s=i;h<s.length;h++){var r=s[h];for(var u in r)void 0!==r[u]&&("object"!=typeof r[u]||void 0===t[u]?t[u]=r[u]:c(t[u],r[u]))}return t}function v(t){return"number"==typeof t&&isFinite(t)}function d(t){return"number"==typeof t&&t%1==0}function _(t){return"string"==typeof t}function w(t){return"boolean"==typeof t}function M(t){var i,n,h,s=t;if(!s||"object"!=typeof s)return s;for(n in i=Array.isArray(s)?[]:{},s)s.hasOwnProperty(n)&&(h=s[n],i[n]=h&&"object"==typeof h?M(h):h);return i}function b(t){return null!==t}function m(t){return null===t?void 0:t}var g=function(){function t(){this.t=[]}return t.prototype.i=function(t){this.t=t},t.prototype.draw=function(t,i,n,h){this.t.forEach((function(s){t.save(),s.draw(t,i,n,h),t.restore()}))},t}(),p=function(){function t(){}return t.prototype.draw=function(t,i,n,h){t.save(),t.scale(i,i),this.h(t,n,h),t.restore()},t.prototype.drawBackground=function(t,i,n,h){t.save(),t.scale(i,i),this.u(t,n,h),t.restore()},t.prototype.u=function(t,i,n){},t}(),y=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&null!==this.o.v){var i=this.o.v,n=this.o,h=function(h){t.beginPath();for(var s=i.to-1;s>=i.from;--s){var r=n._[s];t.moveTo(r.x,r.y),t.arc(r.x,r.y,h,0,2*Math.PI)}t.fill()};t.fillStyle=n.M,h(n.m+2),t.fillStyle=n.g,h(n.m)}},i}(p);var k={from:0,to:1},x=function(){function t(t,i){this.p=new g,this.k=[],this.N=[],this.S=!0,this.C=t,this.D=i,this.p.i(this.k)}return t.prototype.update=function(t){var i=this,n=this.C.serieses();n.length!==this.k.length&&(this.N=n.map((function(){return{_:[{x:0,y:0,time:0,price:0}],g:"",M:i.C.options().layout.backgroundColor,m:0,v:null}})),this.k=this.N.map((function(t){var i=new y;return i.l(t),i})),this.p.i(this.k)),this.S=!0},t.prototype.renderer=function(t,i,n){return this.S&&(this.T(),this.S=!1),this.p},t.prototype.T=function(){var t=this,i=this.C.serieses(),n=this.D.appliedIndex(),h=this.C.timeScale();i.forEach((function(i,s){var r=t.N[s],u=i.markerDataAtIndex(n);if(null!==u&&i.visible()){var e=f(i.firstValue());r.g=u.backgroundColor,r.M=u.borderColor,r.m=u.radius,r._[0].price=u.price,r._[0].y=i.priceScale().priceToCoordinate(u.price,e.value),r._[0].time=n,r._[0].x=h.indexToCoordinate(n),r.v=k}else r.v=null}))},t}(),N=function(){function t(t){this.L=t}return t.prototype.draw=function(t,i,s,r){if(null!==this.L){var u=this.L.A.B,e=this.L.O.B;if(u||e){t.save();var o=Math.round(this.L.V*i),a=Math.round(this.L.P*i),f=Math.ceil(this.L.F*i),l=Math.ceil(this.L.I*i);t.lineCap="butt",u&&o>=0&&(t.lineWidth=Math.floor(this.L.A.W*i),t.strokeStyle=this.L.A.R,t.fillStyle=this.L.A.R,n(t,this.L.A.j),function(t,i,n,h){t.beginPath();var s=t.lineWidth%2?.5:0;t.moveTo(i+s,n),t.lineTo(i+s,h),t.stroke()}(t,o,0,l)),e&&a>=0&&(t.lineWidth=Math.floor(this.L.O.W*i),t.strokeStyle=this.L.O.R,t.fillStyle=this.L.O.R,n(t,this.L.O.j),h(t,a,0,f)),t.restore()}}},t}(),S=function(){function t(t){this.S=!0,this.U={A:{W:1,j:0,R:"",B:!1},O:{W:1,j:0,R:"",B:!1},F:0,I:0,V:0,P:0},this.q=new N(this.U),this.H=t}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(),this.S=!1),this.q},t.prototype.T=function(){var t=this.H.visible(),i=f(this.H.pane()),n=i.model().options().crosshair,h=this.U;h.O.B=t&&this.H.horzLineVisible(i),h.A.B=t&&this.H.vertLineVisible(),h.O.W=n.horzLine.width,h.O.j=n.horzLine.style,h.O.R=n.horzLine.color,h.A.W=n.vertLine.width,h.A.j=n.vertLine.style,h.A.R=n.vertLine.color,h.F=i.width(),h.I=i.height(),h.V=this.H.appliedX(),h.P=this.H.appliedY()},t}(),C={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function D(t){return t<0?0:t>255?255:Math.round(t)||0}var T=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,L=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,E=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,B=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function A(t){var i,n=function(t){var i;if((t=t.toLowerCase())in C&&(t=C[t]),i=B.exec(t)||E.exec(t))return[D(parseInt(i[1],10)),D(parseInt(i[2],10)),D(parseInt(i[3],10))];if(i=L.exec(t))return[D(parseInt(i[1],16)),D(parseInt(i[2],16)),D(parseInt(i[3],16))];if(i=T.exec(t))return[D(17*parseInt(i[1],16)),D(17*parseInt(i[2],16)),D(17*parseInt(i[3],16))];throw new Error("Cannot parse color: "+t)}(t);return{K:"rgb("+n[0]+", "+n[1]+", "+n[2]+")",$:(i=n,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")}}function O(t,i,n,h,s,r){t.fillRect(i+r,n,h-2*r,r),t.fillRect(i+r,n+s-r,h-2*r,r),t.fillRect(i,n,r,s),t.fillRect(i+h-r,n,r,s)}function V(t,i,n){t.save(),t.scale(i,i),n(),t.restore()}function P(t,i,n,h,s,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,h,s),t.restore()}var z,F=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.L=t,this.X=i},t.prototype.draw=function(t,i,n,h,s,r){if(this.L.visible){t.font=i.font;var u=this.L.tickVisible||!this.L.moveTextToInvisibleTick?i.tickLength:0,e=i.borderSize,o=i.paddingTop,a=i.paddingBottom,f=i.paddingInner,l=i.paddingOuter,c=this.L.text,v=Math.ceil(n.measureText(t,c)),d=i.baselineOffset,_=i.fontSize+o+a,w=Math.ceil(.5*_),M=e+v+f+l+u,b=this.X.coordinate;this.X.fixedCoordinate&&(b=this.X.fixedCoordinate);var m,g,p=(b=Math.round(b))-w,y=p+_,k="right"===s,x=k?h:0,N=Math.ceil(h*r),S=x;if(t.fillStyle=this.X.background,t.lineWidth=1,t.lineCap="butt",c){k?(m=x-u,g=(S=x-M)+l):(S=x+M,m=x+u,g=x+e+u+f);var C=Math.max(1,Math.floor(r)),D=Math.max(1,Math.floor(e*r)),T=k?N:0,L=Math.round(p*r),E=Math.round(S*r),B=Math.round(b*r)-Math.floor(.5*r),A=B+C+(B-L),O=Math.round(m*r);t.save(),t.beginPath(),t.moveTo(T,L),t.lineTo(E,L),t.lineTo(E,A),t.lineTo(T,A),t.fill(),t.fillStyle=this.L.borderColor,t.fillRect(k?N-D:0,L,D,A-L),this.L.tickVisible&&(t.fillStyle=this.X.color,t.fillRect(T,B,O-T,C)),t.textAlign="left",t.fillStyle=this.X.color,V(t,r,(function(){t.fillText(c,g,y-a-d)})),t.restore()}}},t.prototype.height=function(t,i){return this.L.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),I=function(){function t(t){this.Z={coordinate:0,color:"#FFF",background:"#000"},this.J={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this.G={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this.S=!0,this.tt=new(t||F)(this.J,this.Z),this.it=new(t||F)(this.G,this.Z)}return t.prototype.text=function(){return this.J.text},t.prototype.coordinate=function(){return this.nt(),this.Z.coordinate},t.prototype.update=function(){this.S=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.tt.height(t,i),this.it.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.Z.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.Z.fixedCoordinate=t},t.prototype.isVisible=function(){return this.nt(),this.J.visible||this.G.visible},t.prototype.isAxisLabelVisible=function(){return this.nt(),this.J.visible},t.prototype.renderer=function(t){return this.nt(),this.J.tickVisible=this.J.tickVisible&&t.options().drawTicks,this.G.tickVisible=this.G.tickVisible&&t.options().drawTicks,this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.tt},t.prototype.paneRenderer=function(){return this.nt(),this.tt.setData(this.J,this.Z),this.it.setData(this.G,this.Z),this.it},t.prototype.nt=function(){this.S&&(this.J.tickVisible=!0,this.G.tickVisible=!1,this.ht(this.J,this.G,this.Z))},t}(),W=function(t){function i(i,n,h){var s=t.call(this)||this;return s.H=i,s.st=n,s.rt=h,s}return r(i,t),i.prototype.ht=function(t,i,n){t.visible=!1;var h=this.H.options().horzLine;if(h.labelVisible){var s=this.st.firstValue();if(this.H.visible()&&!this.st.isEmpty()&&null!==s){var r=A(h.labelBackgroundColor);n.background=r.K,n.color=r.$;var u=this.rt(this.st);n.coordinate=u.ut,t.text=this.st.formatPrice(u.et,s),t.visible=!0}}},i}(I),R=/[1-9]/g,j=function(){function t(){this.L=null}return t.prototype.setData=function(t){this.L=t},t.prototype.draw=function(t,i,n){var h=this;if(null!==this.L&&!1!==this.L.visible&&0!==this.L.text.length){t.font=i.font;var s=Math.round(i.widthCache.measureText(t,this.L.text,R));if(!(s<=0)){t.save();var r=i.paddingHorizontal,u=s+2*r,e=u/2,o=this.L.width,a=this.L.coordinate,l=Math.floor(a-e)+.5;l<0?(a+=Math.abs(0-l),l=Math.floor(a-e)+.5):l+u>o&&(a-=Math.abs(o-(l+u)),l=Math.floor(a-e)+.5);var c=l+u,v=0+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.L.background;var d=Math.round(l*n),_=Math.round(0*n),w=Math.round(c*n),M=Math.round(v*n);t.fillRect(d,_,w-d,M-_);var b=Math.round(this.L.coordinate*n),m=_,g=Math.round((m+i.borderSize+i.tickLength)*n);t.fillStyle=this.L.color;var p=Math.max(1,Math.floor(n)),y=Math.floor(.5*n);t.fillRect(b-y,m,p,g-m);var k=v-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.L.color,V(t,n,(function(){t.fillText(f(h.L).text,l+r,k)})),t.restore()}}},t}(),U=function(){function t(t,i,n){this.S=!0,this.q=new j,this.U={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this.D=t,this.ot=i,this.rt=n}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(){return this.S&&(this.T(),this.S=!1),this.q.setData(this.U),this.q},t.prototype.T=function(){var t=this.U;t.visible=!1;var i=this.D.options().vertLine;if(i.labelVisible){var n=this.ot.timeScale();if(!n.isEmpty()){var h=n.indexToTime(this.D.appliedIndex());t.width=n.width();var s=this.rt();if(s.at){t.coordinate=s.ut,t.text=n.formatDateTime(f(h)),t.visible=!0;var r=A(i.labelBackgroundColor);t.background=r.K,t.color=r.$}}}},t}(),q=function(){function t(){this._priceScale=null,this.ft=0}return t.prototype.zorder=function(){return this.ft},t.prototype.setZorder=function(t){this.ft=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,i){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(z||(z={}));var H=function(t){function i(i,n){var h=t.call(this)||this;h.lt=null,h.ct=NaN,h.vt=0,h.dt=!0,h._t=new Map,h.wt=!1,h.Mt=NaN,h.bt=NaN,h.gt=NaN,h.yt=NaN,h.ot=i,h.kt=n,h.xt=new x(i,h);var s,r;h.Nt=(s=function(){return h.ct},r=function(){return h.bt},function(t){var i=r(),n=s();if(t===f(h.lt).defaultPriceScale())return{et:n,ut:i};var u=f(t.firstValue());return{et:t.coordinateToPrice(i,u),ut:i}});var u=function(t,i){return function(){return{at:h.ot.timeScale().indexToTime(t()),ut:i()}}}((function(){return h.vt}),(function(){return h.appliedX()}));return h.St=new U(h,i,u),h.Ct=new S(h),h}return r(i,t),i.prototype.options=function(){return this.kt},i.prototype.saveOriginCoord=function(t,i){this.gt=t,this.yt=i},i.prototype.clearOriginCoord=function(){this.gt=NaN,this.yt=NaN},i.prototype.originCoordX=function(){return this.gt},i.prototype.originCoordY=function(){return this.yt},i.prototype.setPosition=function(t,i,n){this.wt||(this.wt=!0),this.dt=!0,this.Dt(t,i,n)},i.prototype.appliedIndex=function(){return this.vt},i.prototype.appliedX=function(){return this.Mt},i.prototype.appliedY=function(){return this.bt},i.prototype.visible=function(){return this.dt},i.prototype.clearPosition=function(){this.dt=!1,this.Tt(),this.ct=NaN,this.Mt=NaN,this.bt=NaN,this.lt=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.lt?[this.Ct,this.xt]:[]},i.prototype.horzLineVisible=function(t){return t===this.lt&&this.kt.horzLine.visible},i.prototype.vertLineVisible=function(){return this.kt.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.dt&&this.lt===t||this._t.clear();var n=[];return this.lt===t&&n.push(this.Lt(this._t,i,this.Nt)),n},i.prototype.timeAxisViews=function(){return this.dt?[this.St]:[]},i.prototype.pane=function(){return this.lt},i.prototype.updateAllViews=function(){this.Ct.Y(),this._t.forEach((function(t){return t.update()})),this.St.Y(),this.xt.update()},i.prototype.Et=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.Dt=function(t,i,n){this.Bt(t,i,n)&&this.updateAllViews()},i.prototype.Bt=function(t,i,n){var h=this.Mt,s=this.bt,r=this.ct,u=this.vt,e=this.lt,o=this.Et(n);this.vt=t,this.Mt=isNaN(t)?NaN:this.ot.timeScale().indexToCoordinate(t),this.lt=n;var a=null!==o?o.firstValue():null;return null!==o&&null!==a?(this.ct=i,this.bt=o.priceToCoordinate(i,a)):(this.ct=NaN,this.bt=NaN),h!==this.Mt||s!==this.bt||u!==this.vt||r!==this.ct||e!==this.lt},i.prototype.Tt=function(){var t=this.ot.serieses().map((function(t){return t.bars().lastIndex()})).filter(b),i=0===t.length?null:Math.max.apply(Math,t);this.vt=null!==i?i:NaN},i.prototype.Lt=function(t,i,n){var h=t.get(i);return void 0===h&&(h=new W(this,i,n),t.set(i,h)),h},i}(q),Y=".";function K(t,i){if(!v(t))return"n/a";if(!d(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var $=function(){function t(t,i){if(i||(i=1),v(t)&&d(t)||(t=100),t<0)throw new TypeError("invalid base");this.st=t,this.At=i,this.Ot()}return t.prototype.format=function(t){var i=t<0?"−":"";return t=Math.abs(t),i+this.Vt(t)},t.prototype.Ot=function(){if(this.Pt=0,this.st>0&&this.At>0)for(var t=this.st;t>1;)t/=10,this.Pt++},t.prototype.Vt=function(t){var i=this.st/this.At,n=Math.floor(t),h="",s=void 0!==this.Pt?this.Pt:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this.Pt);r>=i&&(r-=i,n+=1),h=Y+K(+r.toFixed(this.Pt)*this.At,s)}else n=Math.round(n*i)/i,s>0&&(h=Y+K(0,s));return n.toFixed(0)+h},t}(),X=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return r(i,t),i.prototype.format=function(i){return t.prototype.format.call(this,i)+"%"},i}($),Z=function(){function t(){this.zt=[]}return t.prototype.subscribe=function(t,i,n){var h={Ft:t,It:i,Wt:!0===n};this.zt.push(h)},t.prototype.unsubscribe=function(t){var i=this.zt.findIndex((function(i){return t===i.Ft}));i>-1&&this.zt.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.zt=this.zt.filter((function(i){return i.It===t}))},t.prototype.Rt=function(t,i){var n=e(this.zt);this.zt=this.zt.filter((function(t){return!t.Wt})),n.forEach((function(n){return n.Ft(t,i)}))},t.prototype.jt=function(){return this.zt.length>0},t.prototype.Ut=function(){this.zt=[]},t}(),J=function(){function t(t,i){this.qt=t,this.Ht=i}return t.prototype.equals=function(t){return null!==t&&(this.qt===t.qt&&this.Ht===t.Ht)},t.prototype.clone=function(){return new t(this.qt,this.Ht)},t.prototype.minValue=function(){return this.qt},t.prototype.maxValue=function(){return this.Ht},t.prototype.length=function(){return this.Ht-this.qt},t.prototype.isEmpty=function(){return this.Ht===this.qt||Number.isNaN(this.Ht)||Number.isNaN(this.qt)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(v(t)&&0!==this.Ht-this.qt){var i=.5*(this.Ht+this.qt),n=this.Ht-i,h=this.qt-i;n*=t,h*=t,this.Ht=i+n,this.qt=i+h}},t.prototype.shift=function(t){v(t)&&(this.Ht+=t,this.qt+=t)},t.prototype.toRaw=function(){return{minValue:this.qt,maxValue:this.Ht}},t.fromRaw=function(i){return null===i?null:new t(i.minValue,i.maxValue)},t}();function G(t,i,n){return Math.min(Math.max(t,i),n)}function Q(t,i,n){return i-t<=n}function tt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function it(t){var i=Math.ceil(t);return i%2!=0?i-1:i}function nt(t){var i=Math.ceil(t);return i%2==0?i-1:i}function ht(t,i){var n=100*(t-i)/i;return i<0?-n:n}function st(t,i){var n=ht(t.minValue(),i),h=ht(t.maxValue(),i);return new J(n,h)}function rt(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function ut(t,i){var n=rt(t.minValue(),i),h=rt(t.maxValue(),i);return new J(n,h)}function et(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=tt(i+1e-4)+4;return t<0?-n:n}function ot(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=Math.pow(10,i-4)-1e-4;return t<0?-n:n}function at(t){if(null===t)return null;var i=et(t.minValue()),n=et(t.maxValue());return new J(i,n)}var ft,lt=function(){function t(t,i){if(this.Yt=t,this.Kt=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Yt))this.$t=[2,2.5,2];else{this.$t=[];for(var n=this.Yt;1!==n;){if(n%2==0)this.$t.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.$t.push(2,2.5),n/=5}if(this.$t.length>100)throw new Error("something wrong with base")}}}return t.prototype.Xt=function(t,i,n){for(var h,s,r,u=0===this.Yt?0:1/this.Yt,e=1e-9,o=Math.pow(10,Math.max(0,Math.ceil(tt(t-i)))),a=0,f=this.Kt[0];;){var l=Q(o,u,e)&&o>u+e,c=Q(o,n*f,e),v=Q(o,1,e);if(!(l&&c&&v))break;o/=f,f=this.Kt[++a%this.Kt.length]}if(o<=u+e&&(o=u),o=Math.max(1,o),this.$t.length>0&&(h=o,s=1,r=e,Math.abs(h-s)<r))for(a=0,f=this.$t[0];Q(o,n*f,e)&&o>u+e;)o/=f,f=this.$t[++a%this.$t.length];return o},t}(),ct=function(){function t(t,i,n,h){this.Zt=[],this.st=t,this.Yt=i,this.Jt=n,this.Gt=h}return t.prototype.Xt=function(t,i){if(t<i)throw new Error("high < low");var n=this.st.height(),h=(t-i)*this.Qt()/n,s=new lt(this.Yt,[2,2.5,2]),r=new lt(this.Yt,[2,2,2.5]),u=new lt(this.Yt,[2.5,2,2]),e=[];return e.push(s.Xt(t,i,h),r.Xt(t,i,h),u.Xt(t,i,h)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(e)},t.prototype.ti=function(){var t=this.st,i=t.firstValue();if(null!==i){var n=t.height(),h=this.Jt(n-1,i),s=this.Jt(0,i),r=this.st.options().entireTextOnly?this.ii()/2:0,u=r,e=n-1-r,o=Math.max(h,s),a=Math.min(h,s);if(o!==a){for(var f=this.Xt(o,a),l=o%f,c=o>=a?1:-1,v=null,d=0,_=o-(l+=l<0?f:0);_>a;_-=f){var w=this.Gt(_,i,!0);null!==v&&Math.abs(w-v)<this.Qt()||(w<u||w>e||(d<this.Zt.length?(this.Zt[d].coord=w,this.Zt[d].label=t.formatLogical(_)):this.Zt.push({coord:w,label:t.formatLogical(_)}),d++,v=w,t.isLog()&&(f=this.Xt(_*c,a))))}this.Zt.length=d}else this.Zt=[]}else this.Zt=[]},t.prototype.ni=function(){return this.Zt},t.prototype.ii=function(){return this.st.fontSize()},t.prototype.Qt=function(){return Math.ceil(2.5*this.ii())},t}();function vt(t){return t.slice().sort((function(t,i){return f(t.zorder())-f(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(ft||(ft={}));var dt,_t=new X,wt=new $(100,1),Mt=function(){function t(t,i,n,h){this.hi=0,this.si=null,this.ri=null,this.ui=null,this.ei={oi:!1,ai:null},this.fi=0,this.li=0,this.ci=new Z,this.vi=new Z,this.di=[],this._i=null,this.wi=null,this.Mi=null,this.bi=null,this.mi=wt,this.gi=t,this.kt=i,this.pi=n,this.yi=h,this.ki=new ct(this,100,this.xi.bind(this),this.Ni.bind(this))}return t.prototype.id=function(){return this.gi},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){if(c(this.kt,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var i=a(t.scaleMargins.top),n=a(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+n);if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+n));this.Si(),this.wi=null}},t.prototype.isAutoScale=function(){return this.kt.autoScale},t.prototype.isLog=function(){return 1===this.kt.mode},t.prototype.isPercentage=function(){return 2===this.kt.mode},t.prototype.isIndexedTo100=function(){return 3===this.kt.mode},t.prototype.mode=function(){return{autoScale:this.kt.autoScale,isInverted:this.kt.invertScale,mode:this.kt.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.kt.autoScale=t.autoScale),void 0!==t.mode&&(this.kt.mode=t.mode,2!==t.mode&&3!==t.mode||(this.kt.autoScale=!0),this.ei.oi=!1),1===i.mode&&t.mode!==i.mode&&(!function(t){if(null===t)return!1;var i=ot(t.minValue()),n=ot(t.maxValue());return isFinite(i)&&isFinite(n)}(this.ri)?this.kt.autoScale=!0:null!==(n=function(t){if(null===t)return null;var i=ot(t.minValue()),n=ot(t.maxValue());return new J(i,n)}(this.ri))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=at(this.ri))&&this.setPriceRange(n);var h=i.mode!==this.kt.mode;h&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),h&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.kt.invertScale=t.isInverted,this.Ci()),this.vi.Rt(i,this.mode())},t.prototype.modeChanged=function(){return this.vi},t.prototype.fontSize=function(){return this.pi.fontSize},t.prototype.height=function(){return this.hi},t.prototype.setHeight=function(t){this.hi!==t&&(this.hi=t,this.Si(),this.wi=null)},t.prototype.internalHeight=function(){if(this.si)return this.si;var t=this.height()-this.Di()-this.Ti();return this.si=t,t},t.prototype.priceRange=function(){return this.Li(),this.ri},t.prototype.setPriceRange=function(t,i){var n=this.ri;(i||null===n&&null!==t||null!==n&&!n.equals(t))&&(this.wi=null,this.ri=t)},t.prototype.isEmpty=function(){return this.Li(),0===this.hi||!this.ri||this.ri.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i){return this.isPercentage()?t=ht(t,i):this.isIndexedTo100()&&(t=rt(t,i)),this.Ni(t,i)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.Li();for(var h=this.Ti(),s=f(this.priceRange()),r=s.minValue(),u=s.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Ei(),d=l;d<c;d++){var _=t[d],w=_.price;if(!isNaN(w)){var M=w;null!==v&&(M=v(_.price,i));var b=h+a*(M-r),m=o?b:this.hi-1-b;_.y=m}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.Li();for(var h=this.Ti(),s=f(this.priceRange()),r=s.minValue(),u=s.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),l=void 0===n?0:n.from,c=void 0===n?t.length:n.to,v=this.Ei(),d=l;d<c;d++){var _=t[d],w=_.open,M=_.high,b=_.low,m=_.close;null!==v&&(w=v(_.open,i),M=v(_.high,i),b=v(_.low,i),m=v(_.close,i));var g=h+a*(w-r),p=o?g:this.hi-1-g;_.openY=p,g=h+a*(M-r),p=o?g:this.hi-1-g,_.highY=p,g=h+a*(b-r),p=o?g:this.hi-1-g,_.lowY=p,g=h+a*(m-r),p=o?g:this.hi-1-g,_.closeY=p}},t.prototype.coordinateToPrice=function(t,i){var n=this.xi(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.di},t.prototype.orderedSources=function(){if(this._i)return this._i;for(var t=[],i=0;i<this.di.length;i++){var n=this.di[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=vt(t),this._i=t,this._i},t.prototype.addDataSource=function(t){-1===this.di.indexOf(t)&&(this.di.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.di.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.di.splice(i,1),0===this.di.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){for(var t=null,i=0,n=this.di;i<n.length;i++){var h=n[i].firstValue();null!==h&&((null===t||h.timePoint<t.timePoint)&&(t=h))}return null===t?null:t.value},t.prototype.isInverted=function(){return this.kt.invertScale},t.prototype.marks=function(){return this.wi||(this.ki.ti(),this.wi=this.ki.ni(),this.ci.Rt()),this.wi},t.prototype.onMarksChanged=function(){return this.ci},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.Mi&&null===this.ui&&(this.isEmpty()||(this.Mi=this.hi-t,this.ui=f(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.Mi){this.setMode({autoScale:!1}),(t=this.hi-t)<0&&(t=0);var i=(this.Mi+.2*(this.hi-1))/(t+.2*(this.hi-1)),n=f(this.ui).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.Mi=null,this.ui=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.bi&&null===this.ui&&(this.isEmpty()||(this.bi=t,this.ui=f(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.bi){var i=f(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.bi;this.isInverted()&&(n*=-1);var h=n*i,s=f(this.ui).clone();s.shift(h),this.setPriceRange(s,!0),this.wi=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.bi&&(this.bi=null,this.ui=null)},t.prototype.formatter=function(){return this.mi||this.updateFormatter(),this.mi},t.prototype.formatPrice=function(t,i){switch(this.kt.mode){case 2:return this.formatter().format(ht(t,i));case 3:return this.formatter().format(rt(t,i));default:return this.Bi(t)}},t.prototype.formatLogical=function(t){switch(this.kt.mode){case 2:case 3:return this.formatter().format(t);default:return this.Bi(t)}},t.prototype.formatPriceAbsolute=function(t){return this.Bi(t,f(this.Ai()).formatter())},t.prototype.formatPricePercentage=function(t,i){return t=ht(t,i),_t.format(t)},t.prototype.sourcesForAutoScale=function(){return this.di},t.prototype.recalculatePriceRange=function(t){this.ei={ai:t,oi:!1}},t.prototype.updateAllViews=function(){this.di.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.wi=null;var t=this.Ai(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.mi=wt,this.isPercentage()?(this.mi=_t,i=100):this.isIndexedTo100()?(this.mi=new $(100,1),i=100):null!==t&&(this.mi=t.formatter()),this.ki=new ct(this,i,this.xi.bind(this),this.Ni.bind(this)),this.ki.ti()},t.prototype.invalidateSourcesCache=function(){this._i=null},t.prototype.Ai=function(){return this.di[0]||null},t.prototype.Di=function(){return this.isInverted()?this.kt.scaleMargins.bottom*this.height()+this.li:this.kt.scaleMargins.top*this.height()+this.fi},t.prototype.Ti=function(){return this.isInverted()?this.kt.scaleMargins.top*this.height()+this.fi:this.kt.scaleMargins.bottom*this.height()+this.li},t.prototype.Li=function(){this.ei.oi||(this.ei.oi=!0,this.Oi())},t.prototype.Si=function(){this.si=null},t.prototype.Ni=function(t,i){if(this.Li(),this.isEmpty())return 0;t=this.isLog()&&t?et(t):t;var n=f(this.priceRange()),h=this.Ti()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(h)},t.prototype.xi=function(t,i){if(this.Li(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),h=f(this.priceRange()),s=h.minValue()+h.length()*((n-this.Ti())/(this.internalHeight()-1));return this.isLog()?ot(s):s},t.prototype.Ci=function(){this.wi=null,this.ki.ti()},t.prototype.Oi=function(){var t=this.ei.ai;if(null!==t){for(var i=null,n=0,h=0,s=0,r=this.sourcesForAutoScale();s<r.length;s++){var u=r[s];if(u.visible()){var e=u.firstValue();if(null!==e){var o=u.autoscaleInfo(t.left(),t.right()),a=o&&o.priceRange();if(null!==a){switch(this.kt.mode){case 1:a=at(a);break;case 2:a=st(a,e.value);break;case 3:a=ut(a,e.value)}if(i=null===i?a:i.merge(f(a)),null!==o){var l=o.margins();null!==l&&(n=Math.max(n,l.above),h=Math.max(n,l.below))}}}}}if(n===this.fi&&h===this.li||(this.fi=n,this.li=h,this.wi=null,this.Si()),null!==i){if(i.minValue()===i.maxValue()){var c=this.Ai(),v=5*(null===c||this.isPercentage()||this.isIndexedTo100()?1:c.minMove());i=new J(i.minValue()-v,i.maxValue()+v)}this.setPriceRange(i)}else null===this.ri&&this.setPriceRange(new J(-.5,.5));this.ei.oi=!0}},t.prototype.Ei=function(){return this.isPercentage()?ht:this.isIndexedTo100()?rt:this.isLog()?et:null},t.prototype.Bi=function(t,i){return void 0===this.yi.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.yi.priceFormatter(t)},t}();function bt(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}!function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(dt||(dt={}));var mt=function(t){return t.getUTCFullYear()};function gt(t,i,n){return i.replace(/yyyy/g,function(t){return K(mt(t),4)}(t)).replace(/yy/g,function(t){return K(mt(t)%100,2)}(t)).replace(/MMMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"})}(t,n)).replace(/MMM/g,function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,n)).replace(/MM/g,function(t){return K(function(t){return t.getUTCMonth()+1}(t),2)}(t)).replace(/dd/g,function(t){return K(function(t){return t.getUTCDate()}(t),2)}(t))}var pt=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Vi=t,this.Pi=i}return t.prototype.format=function(t){return gt(t,this.Vi,this.Pi)},t}(),yt=function(){function t(t){this.zi=t||"%h:%m:%s"}return t.prototype.format=function(t){return this.zi.replace("%h",K(t.getUTCHours(),2)).replace("%m",K(t.getUTCMinutes(),2)).replace("%s",K(t.getUTCSeconds(),2))},t}(),kt={Fi:"yyyy-MM-dd",Ii:"%h:%m:%s",Wi:" ",Ri:"default"},xt=function(){function t(t){void 0===t&&(t={});var i=u(u({},kt),t);this.ji=new pt(i.Fi,i.Ri),this.Ui=new yt(i.Ii),this.qi=i.Wi}return t.prototype.format=function(t){return""+this.ji.format(t)+this.qi+this.Ui.format(t)},t}();var Nt=function(){function t(t,i){void 0===i&&(i=50),this.Hi=0,this.Yi=1,this.Ki=1,this.$i=new Map,this.Xi=new Map,this.Zi=t,this.Ji=i}return t.prototype.Gi=function(t){var i=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this.$i.get(i);if(void 0!==n)return n.Qi;if(this.Hi===this.Ji){var h=this.Xi.get(this.Ki);this.Xi.delete(this.Ki),this.$i.delete(a(h)),this.Ki++,this.Hi--}var s=this.Zi(t);return this.$i.set(i,{Qi:s,tn:this.Yi}),this.Xi.set(this.Yi,i),this.Hi++,this.Yi++,s},t}(),St=function(){function t(t,i){o(t<=i,"right should be >= left"),this.nn=t,this.hn=i}return t.prototype.left=function(){return this.nn},t.prototype.right=function(){return this.hn},t.prototype.count=function(){return this.hn-this.nn+1},t.prototype.contains=function(t){return this.nn<=t&&t<=this.hn},t.prototype.equals=function(t){return this.nn===t.left()&&this.hn===t.right()},t}();function Ct(t,i){return null===t||null===i?t===i:t.equals(i)}var Dt,Tt=function(){function t(){this.sn=new Map,this.$i=null}return t.prototype.setTimeScalePoints=function(t){var i=this;this.$i=null,this.sn.clear(),t.forEach((function(t,n){var h=i.sn.get(t.timeWeight);void 0===h&&(h=[],i.sn.set(t.timeWeight,h)),h.push({index:n,time:t.time,weight:t.timeWeight})}))},t.prototype.build=function(t,i){var n=Math.ceil(i/t);return null!==this.$i&&this.$i.rn===n||(this.$i={ni:this.un(n),rn:n}),this.$i.ni},t.prototype.un=function(t){for(var i=[],n=0,h=Array.from(this.sn.keys()).sort((function(t,i){return i-t}));n<h.length;n++){var s=h[n];if(this.sn.get(s)){var r=i;i=[];for(var u=r.length,e=0,o=a(this.sn.get(s)),f=o.length,l=1/0,c=-1/0,v=0;v<f;v++){for(var d=o[v],_=d.index;e<u;){var w=r[e],M=w.index;if(!(M<_)){l=M;break}e++,i.push(w),c=M,l=1/0}l-_>=t&&_-c>=t&&(i.push(d),c=_)}for(;e<u;e++)i.push(r[e])}}return i},t}(),Lt=function(){function t(t){this.en=t}return t.prototype.on=function(){return null===this.en?null:new St(Math.floor(this.en.left()),Math.ceil(this.en.right()))},t.prototype.an=function(){return this.en},t.fn=function(){return new t(null)},t}();!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(Dt||(Dt={}));var Et=function(){function t(t,i,n){this.ln=0,this.cn=null,this.vn=[],this.bi=null,this.Mi=null,this.dn=new Tt,this._n=new Map,this.wn=Lt.fn(),this.Mn=!0,this.bn=new Z,this.mn=new Z,this.gn=new Z,this.pn=null,this.yn=null,this.kn=[],this.kt=i,this.yi=n,this.xn=i.rightOffset,this.Nn=i.barSpacing,this.ot=t,this.Sn()}return t.prototype.options=function(){return this.kt},t.prototype.applyLocalizationOptions=function(t){c(this.yi,t),this.Cn(),this.Sn()},t.prototype.applyOptions=function(t,i){c(this.kt,t),this.kt.fixLeftEdge&&this.Dn(),void 0!==t.barSpacing&&this.ot.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.ot.setRightOffset(t.rightOffset),this.Cn(),this.Sn(),this.gn.Rt()},t.prototype.indexToTime=function(t){var i;return(null===(i=this.vn[t])||void 0===i?void 0:i.time)||null},t.prototype.timeToIndex=function(t,i){if(this.vn.length<1)return null;if(t.timestamp>this.vn[this.vn.length-1].time.timestamp)return i?this.vn.length-1:null;for(var n=0;n<this.vn.length;++n){if(t.timestamp===this.vn[n].time.timestamp)return n;if(t.timestamp<this.vn[n].time.timestamp)return i?n:null}return null},t.prototype.isEmpty=function(){return 0===this.ln||0===this.vn.length},t.prototype.visibleStrictRange=function(){return this.Tn(),this.wn.on()},t.prototype.visibleLogicalRange=function(){return this.Tn(),this.wn.an()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)},t.prototype.timeRangeForLogicalRange=function(t){var i=Math.round(t.from),n=Math.round(t.to),h=f(this.Ln()),s=f(this.En());return{from:f(this.indexToTime(Math.max(h,i))),to:f(this.indexToTime(Math.min(s,n)))}},t.prototype.logicalRangeForTimeRange=function(t){var i=this.ot.timeScale();return{from:f(i.timeToIndex(t.from,!0)),to:f(i.timeToIndex(t.to,!0))}},t.prototype.tickMarks=function(){return this.dn},t.prototype.width=function(){return this.ln},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this.ln!==t){if(this.kt.lockVisibleTimeRangeOnResize&&this.ln){var i=this.Nn*t/this.ln;this.Bn(i)}if(this.kt.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n)if(n.left()<=0){var h=this.ln-t;this.xn-=Math.round(h/this.Nn)+1}}this.ln=t,this.Mn=!0,this.An(),this.On()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty()||!d(t))return 0;var i=this.baseIndex()+this.xn-t;return this.ln-(i+.5)*this.Nn},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),h=void 0===i?0:i.from,s=void 0===i?t.length:i.to,r=h;r<s;r++){var u=t[r].time,e=n+this.xn-u,o=this.ln-(e+.5)*this.Nn;t[r].x=o}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.Vn(t))},t.prototype.setRightOffset=function(t){this.Mn=!0,this.xn=t,this.On(),this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.barSpacing=function(){return this.Nn},t.prototype.setBarSpacing=function(t){this.Bn(t),this.On(),this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.rightOffset=function(){return this.xn},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.yn)return this.yn;for(var t=this.Nn,i=5*(this.ot.options().layout.fontSize+4),n=Math.round(i/t),h=f(this.visibleStrictRange()),s=Math.max(h.left(),h.left()-n),r=Math.max(h.right(),h.right()-n),u=0,e=0,o=this.dn.build(t,i);e<o.length;e++){var a=o[e];if(s<=a.index&&a.index<=r){var l=this.indexToTime(a.index);if(null!==l){if(u<this.kn.length){var c=this.kn[u];c.coord=this.indexToCoordinate(a.index),c.label=this.Pn(l,a.weight),c.weight=a.weight}else this.kn.push({coord:this.indexToCoordinate(a.index),label:this.Pn(l,a.weight),weight:a.weight});u++}}}return this.kn.length=u,this.yn=this.kn,this.kn},t.prototype.restoreDefault=function(){this.Mn=!0,this.setBarSpacing(this.kt.barSpacing),this.setRightOffset(this.kt.rightOffset)},t.prototype.setBaseIndex=function(t){this.Mn=!0,this.cn=t,this.On(),this.Dn()},t.prototype.zoom=function(t,i){var n=this.Vn(t),h=this.barSpacing(),s=h+i*(h/10);this.setBarSpacing(s),this.kt.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.Vn(t)))},t.prototype.startScale=function(t){this.bi&&this.endScroll(),null===this.Mi&&null===this.pn&&(this.isEmpty()||(this.Mi=t,this.zn()))},t.prototype.scaleTo=function(t){if(null!==this.pn){var i=G(this.ln-t,0,this.ln),n=G(this.ln-f(this.Mi),0,this.ln);0!==i&&0!==n&&this.setBarSpacing(this.pn.Fn*i/n)}},t.prototype.endScale=function(){null!==this.Mi&&(this.Mi=null,this.In())},t.prototype.startScroll=function(t){null===this.bi&&null===this.pn&&(this.isEmpty()||(this.bi=t,this.zn()))},t.prototype.scrollTo=function(t){if(null!==this.bi){var i=(this.bi-t)/this.barSpacing();this.xn=f(this.pn).Wn+i,this.Mn=!0,this.On()}},t.prototype.endScroll=function(){null!==this.bi&&(this.bi=null,this.In())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.kt.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var h=this.xn,s=Date.now(),r=function(){var u=(Date.now()-s)/i,e=u>=1,o=e?t:h+(t-h)*u;n.setRightOffset(o),e||setTimeout(r,20)};r()},t.prototype.update=function(t){this.Mn=!0,this.vn=t,this.dn.setTimeScalePoints(t),this.On()},t.prototype.visibleBarsChanged=function(){return this.bn},t.prototype.logicalRangeChanged=function(){return this.mn},t.prototype.optionsApplied=function(){return this.gn},t.prototype.baseIndex=function(){return this.cn||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.Bn(this.ln/i),this.xn=t.right()-this.baseIndex(),this.On(),this.Mn=!0,this.ot.recalculateAllPanes(),this.ot.lightUpdate()},t.prototype.fitContent=function(){var t=this.Ln(),i=this.En();null!==t&&null!==i&&this.setVisibleRange(new St(t,i+this.kt.rightOffset))},t.prototype.setLogicalRange=function(t){var i=new St(t.from,t.to);this.setVisibleRange(i)},t.prototype.formatDateTime=function(t){return void 0!==this.yi.timeFormatter?this.yi.timeFormatter(t.businessDay||t.timestamp):this.Rn.format(new Date(1e3*t.timestamp))},t.prototype.Ln=function(){return 0===this.vn.length?null:0},t.prototype.En=function(){return 0===this.vn.length?null:this.vn.length-1},t.prototype.jn=function(t){return(this.ln+1-t)/this.Nn},t.prototype.Vn=function(t){var i=this.jn(t),n=this.baseIndex()+this.xn-i;return Math.round(1e6*n)/1e6},t.prototype.Bn=function(t){var i=this.Nn;this.Nn=t,this.An(),i!==this.Nn&&(this.Mn=!0,this.Un())},t.prototype.Tn=function(){if(this.Mn)if(this.Mn=!1,this.isEmpty())this.qn(Lt.fn());else{var t=this.baseIndex(),i=this.ln/this.Nn,n=this.xn+t,h=new St(n-i+1,n);this.qn(new Lt(h))}},t.prototype.An=function(){if(this.Nn<.5&&(this.Nn=.5,this.Mn=!0),0!==this.ln){var t=.5*this.ln;this.Nn>t&&(this.Nn=t,this.Mn=!0)}},t.prototype.On=function(){var t=this.Hn();this.xn>t&&(this.xn=t,this.Mn=!0);var i=this.Yn();null!==i&&this.xn<i&&(this.xn=i,this.Mn=!0)},t.prototype.Yn=function(){var t=this.Ln(),i=this.cn;return null===t||null===i?null:t-i-1+(this.kt.fixLeftEdge?this.ln/this.Nn:Math.min(2,this.vn.length))},t.prototype.Hn=function(){return this.ln/this.Nn-Math.min(2,this.vn.length)},t.prototype.zn=function(){this.pn={Fn:this.barSpacing(),Wn:this.rightOffset()}},t.prototype.In=function(){this.pn=null},t.prototype.Pn=function(t,i){var n=this,h=this._n.get(i);return void 0===h&&(h=new Nt((function(t){return n.Kn(t,i)})),this._n.set(i,h)),h.Gi(t)},t.prototype.Kn=function(t,i){var n,h,s=this.kt.timeVisible;return h=i<20&&s?this.kt.secondsVisible?4:3:i<40&&s?3:i<50||i<60?2:i<70?1:0,void 0!==this.kt.tickMarkFormatter?this.kt.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,h,this.yi.locale):function(t,i,n){var h={};switch(i){case 0:h.year="numeric";break;case 1:h.month="short";break;case 2:h.day="numeric";break;case 3:h.hour12=!1,h.hour="2-digit",h.minute="2-digit";break;case 4:h.hour12=!1,h.hour="2-digit",h.minute="2-digit",h.second="2-digit"}var s=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()).toLocaleString(n,h)}(t,h,this.yi.locale)},t.prototype.qn=function(t){var i=this.wn;this.wn=t,Ct(i.on(),this.wn.on())||this.bn.Rt(),Ct(i.an(),this.wn.an())||this.mn.Rt(),this.Un()},t.prototype.Un=function(){this.yn=null},t.prototype.Cn=function(){this.Un(),this._n.clear()},t.prototype.Sn=function(){var t=this.yi.dateFormat;this.kt.timeVisible?this.Rn=new xt({Fi:t,Ii:this.kt.secondsVisible?"%h:%m:%s":"%h:%m",Wi:"   ",Ri:this.yi.locale}):this.Rn=new pt(t,this.yi.locale)},t.prototype.Dn=function(){if(this.kt.fixLeftEdge){var t=this.Ln();if(null!==t){var i=f(this.visibleStrictRange()).left()-t;if(i<0){var n=this.xn-i-1;this.setRightOffset(n)}}}},t}();function Bt(t){return!v(t)&&!_(t)}function At(t){return v(t)}var Ot="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Vt(t,i,n){return void 0!==n?n+=" ":n="",void 0===i&&(i=Ot),""+n+t+"px "+i}var Pt=function(){function t(t){this.$n={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.C=t}return t.prototype.options=function(){var t=this.$n,i=this.Xn(),n=this.Zn();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=Vt(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/10)),t.color=this.Jn(),this.$n},t.prototype.Jn=function(){return this.C.options().layout.textColor},t.prototype.Xn=function(){return this.C.options().layout.fontSize},t.prototype.Zn=function(){return this.C.options().layout.fontFamily},t}();function zt(t){return"left"===t||"right"===t}var Ft=function(){function t(t){this.Gn=new Map,this.Qn=!1,this.th=[],this.ih=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Gn.get(t),i);this.Gn.set(t,n)},t.prototype.fullInvalidation=function(){return this.ih},t.prototype.invalidateForPane=function(t){var i=this.Gn.get(t);return void 0===i?{level:this.ih}:{level:Math.max(this.ih,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.th=[{type:0}]},t.prototype.applyRange=function(t){this.th=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this.th=[{type:4}]},t.prototype.setBarSpacing=function(t){this.th.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this.th.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this.th},t.prototype.merge=function(t){var i=this;this.Qn=this.Qn||t.Qn,this.th=this.th.concat(t.th);for(var n=0,h=t.th;n<h.length;n++){var s=h[n];this.nh(s)}this.ih=Math.max(this.ih,t.ih),t.Gn.forEach((function(t,n){i.invalidatePane(n,t)}))},t.prototype.nh=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),It=function(){function t(t){this.hh=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.sh(t):t<999995?i+this.sh(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.sh(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.sh(t/1e9)+"B")},t.prototype.sh=function(t){var i=Math.pow(10,this.hh);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.hh).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function Wt(t,i,n,h){if(0!==i.length){var s=i[h.from].V,r=i[h.from].P;t.moveTo(s,r);for(var u=h.from+1;u<h.to;++u){var e=i[u];if(1===n){var o=i[u-1].P,a=e.V;t.lineTo(a,o)}t.lineTo(e.V,e.P)}}}var Rt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.strokeStyle=this.o.g,t.lineWidth=this.o.W,n(t,this.o.j),t.lineWidth=1,t.beginPath(),1===this.o._.length){var i=this.o._[0],h=this.o.rh/2;t.moveTo(i.x-h,this.o.uh),t.lineTo(i.x-h,i.y),t.lineTo(i.x+h,i.y),t.lineTo(i.x+h,this.o.uh)}else t.moveTo(this.o._[this.o.v.from].x,this.o.uh),t.lineTo(this.o._[this.o.v.from].x,this.o._[this.o.v.from].y),Wt(t,this.o._,this.o.eh,this.o.v),this.o.v.to>this.o.v.from&&(t.lineTo(this.o._[this.o.v.to-1].x,this.o.uh),t.lineTo(this.o._[this.o.v.from].x,this.o.uh));t.closePath();var s=t.createLinearGradient(0,0,0,this.o.uh);s.addColorStop(0,this.o.oh),s.addColorStop(1,this.o.ah),t.fillStyle=s,t.fill()}},i}(p),jt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.o=null,i}return r(i,t),i.prototype.l=function(t){this.o=t},i.prototype.h=function(t){if(null!==this.o&&0!==this.o._.length&&null!==this.o.v){if(t.lineCap="butt",t.lineWidth=this.o.W,n(t,this.o.j),t.strokeStyle=this.o.g,t.lineJoin="miter",t.beginPath(),1===this.o._.length){var i=this.o._[0];t.moveTo(i.x-this.o.rh/2,i.y),t.lineTo(i.x+this.o.rh/2,i.y)}else Wt(t,this.o._,this.o.eh,this.o.v);t.stroke()}},i}(p);function Ut(t,i,n,h,s){void 0===h&&(h=0),void 0===s&&(s=t.length);for(var r=s-h;0<r;){var u=r>>1,e=h+u;n(t[e],i)?(h=e+1,r-=u+1):r=u}return h}function qt(t,i,n,h,s){void 0===h&&(h=0),void 0===s&&(s=t.length);for(var r=s-h;0<r;){var u=r>>1,e=h+u;n(i,t[e])?r=u:(h=e+1,r-=u+1)}return h}function Ht(t,i){return t.time<i}function Yt(t,i){return t<i.time}function Kt(t,i,n){var h=i.left(),s=i.right(),r=Ut(t,h,Ht),u=qt(t,s,Yt);if(!n)return{from:r,to:u};var e=r,o=u;return r>0&&r<t.length&&t[r].time>=h&&(e=r-1),u>0&&u<t.length&&t[u-1].time<=s&&(o=u+1),{from:e,to:o}}var $t=function(){function t(t,i,n){this.fh=!0,this.lh=!0,this.dh=[],this._h=null,this.wh=t,this.Mh=i,this.bh=n}return t.prototype.update=function(t){this.fh=!0,"data"===t&&(this.lh=!0)},t.prototype.mh=function(){this.lh&&(this.gh(),this.lh=!1),this.fh&&(this.ph(),this.fh=!1)},t.prototype.yh=function(){this._h=null},t.prototype.ph=function(){var t=this.wh.priceScale(),i=this.Mh.timeScale();if(this.yh(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleStrictRange();if(null!==n&&0!==this.wh.bars().size()){var h=this.wh.firstValue();null!==h&&(this._h=Kt(this.dh,n,this.bh),this.kh(t,i,h.value))}}},t}(),Xt=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return r(i,t),i.prototype.kh=function(t,i,n){i.indexesToCoordinates(this.dh,m(this._h)),t.pointsArrayToCoordinates(this.dh,n,m(this._h))},i.prototype.xh=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype.gh=function(){var t=this,i=this.wh.barColorer();this.dh=this.wh.bars().rows().map((function(n){var h=n.value[3];return t.Nh(n.index,h,i)}))},i}($t),Zt=function(t){function i(i,n){var h=t.call(this,i,n)||this;return h.q=new g,h.Sh=new Rt,h.Ch=new jt,h.q.i([h.Sh,h.Ch]),h}return r(i,t),i.prototype.renderer=function(t,i){if(!this.wh.visible())return null;var n=this.wh.options();this.mh();var h={eh:n.lineType,_:this.dh,g:n.lineColor,j:n.lineStyle,W:n.lineWidth,oh:n.topColor,ah:n.bottomColor,uh:t,v:this._h,rh:this.Mh.timeScale().barSpacing()};return this.Sh.l(h),this.Ch.l(h),this.q},i.prototype.Nh=function(t,i){return this.xh(t,i)},i}(Xt);var Jt=function(){function t(){this.L=null,this.Dh=0,this.Th=0}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L.Lh.length&&null!==this.L.v){if(this.Dh=this.Eh(i),this.Dh>=2)Math.max(1,Math.floor(i))%2!=this.Dh%2&&this.Dh--;this.Th=this.L.Bh?Math.min(this.Dh,Math.floor(i)):this.Dh;for(var s=null,r=this.Th<=this.Dh&&this.L.Fn>=Math.floor(1.5*i),u=this.L.v.from;u<this.L.v.to;++u){var e=this.L.Lh[u];s!==e.R&&(t.fillStyle=e.R,s=e.R);var o=Math.floor(.5*this.Th),a=Math.round(e.x*i),f=a-o,l=this.Th,c=f+l-1,v=Math.min(e.highY,e.lowY),d=Math.max(e.highY,e.lowY),_=Math.round(v*i)-o,w=Math.round(d*i)+o,M=Math.max(w-_,this.Th);t.fillRect(f,_,l,M);var b=Math.ceil(1.5*this.Dh);if(r){if(this.L.Ah){var m=a-b,g=Math.max(_,Math.round(e.openY*i)-o),p=g+l-1;p>_+M-1&&(g=(p=_+M-1)-l+1),t.fillRect(m,g,f-m,p-g+1)}var y=a+b,k=Math.max(_,Math.round(e.closeY*i)-o),x=k+l-1;x>_+M-1&&(k=(x=_+M-1)-l+1),t.fillRect(c+1,k,y-c,x-k+1)}}}},t.prototype.Eh=function(t){var i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.L).Fn,t)))},t}(),Gt=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return r(i,t),i.prototype.kh=function(t,i,n){i.indexesToCoordinates(this.dh,m(this._h)),t.barPricesToCoordinates(this.dh,n,m(this._h))},i.prototype.Oh=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype.gh=function(){var t=this,i=this.wh.barColorer();this.dh=this.wh.bars().rows().map((function(n){return t.Nh(n.index,n,i)}))},i}($t),Qt=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new Jt,i}return r(i,t),i.prototype.renderer=function(t,i){if(!this.wh.visible())return null;var n=this.wh.options();this.mh();var h={Lh:this.dh,Fn:this.Mh.timeScale().barSpacing(),Ah:n.openVisible,Bh:n.thinBars,v:this._h};return this.q.l(h),this.q},i.prototype.Nh=function(t,i,n){return u(u({},this.Oh(t,i,n)),{R:n.barStyle(t).barColor})},i}(Gt),ti=function(){function t(){this.L=null,this.Dh=0}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L.Lh.length&&null!==this.L.v){if(this.Dh=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);var n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),h=Math.floor(t*n*i),s=Math.floor(t*i),r=Math.min(h,s);return Math.max(Math.floor(i),r)}(this.L.Fn,i),this.Dh>=2)Math.floor(i)%2!=this.Dh%2&&this.Dh--;var s=this.L.Lh;this.L.Vh&&this.Ph(t,s,this.L.v,i),this.L.zh&&this.Fh(t,s,this.L.v,this.L.Fn,i);var r=this.Ih(i);(!this.L.zh||this.Dh>2*r)&&this.Wh(t,s,this.L.v,i)}},t.prototype.Ph=function(t,i,n,h){if(null!==this.L){var s="",r=Math.min(Math.floor(h),Math.floor(this.L.Fn*h));r=Math.max(Math.floor(h),Math.min(r,this.Dh));for(var u=Math.floor(.5*r),e=null,o=n.from;o<n.to;o++){var a=i[o];a.Rh!==s&&(t.fillStyle=a.Rh,s=a.Rh);var f=Math.round(Math.min(a.openY,a.closeY)*h),l=Math.round(Math.max(a.openY,a.closeY)*h),c=Math.round(a.highY*h),v=Math.round(a.lowY*h),d=Math.round(h*a.x)-u,_=d+r-1;null!==e&&(d=Math.max(e+1,d),d=Math.min(d,_));var w=_-d+1;t.fillRect(d,c,w,f-c),t.fillRect(d,l+1,w,v-l),e=_}}},t.prototype.Ih=function(t){var i=Math.floor(1*t);this.Dh<=2*i&&(i=Math.floor(.5*(this.Dh-1)));var n=Math.max(Math.floor(t),i);return this.Dh<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype.Fh=function(t,i,n,h,s){if(null!==this.L)for(var r="",u=this.Ih(s),e=null,o=n.from;o<n.to;o++){var a=i[o];a.jh!==r&&(t.fillStyle=a.jh,r=a.jh);var f=Math.round(a.x*s)-Math.floor(.5*this.Dh),l=f+this.Dh-1,c=Math.round(Math.min(a.openY,a.closeY)*s),v=Math.round(Math.max(a.openY,a.closeY)*s);if(null!==e&&(f=Math.max(e+1,f),f=Math.min(f,l)),this.L.Fn*s>2*u)O(t,f,c,l-f+1,v-c+1,u);else{var d=l-f+1;t.fillRect(f,c,d,v-c+1)}e=l}},t.prototype.Wh=function(t,i,n,h){if(null!==this.L)for(var s="",r=this.Ih(h),u=n.from;u<n.to;u++){var e=i[u],o=Math.round(Math.min(e.openY,e.closeY)*h),a=Math.round(Math.max(e.openY,e.closeY)*h),f=Math.round(e.x*h)-Math.floor(.5*this.Dh),l=f+this.Dh-1;if(e.R!==s){var c=e.R;t.fillStyle=c,s=c}this.L.zh&&(f+=r,o+=r,l-=r,a-=r),o>a||t.fillRect(f,o,l-f+1,a-o+1)}},t}(),ii=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.q=new ti,i}return r(i,t),i.prototype.renderer=function(t,i){if(!this.wh.visible())return null;var n=this.wh.options();this.mh();var h={Lh:this.dh,Fn:this.Mh.timeScale().barSpacing(),Vh:n.wickVisible,zh:n.borderVisible,v:this._h};return this.q.l(h),this.q},i.prototype.Nh=function(t,i,n){var h=n.barStyle(t);return u(u({},this.Oh(t,i,n)),{R:h.barColor,Rh:h.barWickColor,jh:h.barBorderColor})},i}(Gt),ni=function(){function t(){this.L=null,this.Uh=[]}return t.prototype.l=function(t){this.L=t,this.Uh=[]},t.prototype.draw=function(t,i,n,h){if(null!==this.L&&0!==this.L._.length&&null!==this.L.v){this.Uh.length||this.qh(i);for(var s=Math.max(1,Math.floor(i)),r=Math.round(this.L.Hh*i)-Math.floor(s/2),u=r+s,e=this.L.v.from;e<this.L.v.to;e++){var o=this.L._[e],a=this.Uh[e-this.L.v.from],f=Math.round(o.y*i);t.fillStyle=o.R;var l=void 0,c=void 0;f<=r?(l=f,c=u):(l=r,c=f-Math.floor(s/2)+s),t.fillRect(a.Yh,l,a.Kh-a.Yh+1,c-l)}}},t.prototype.qh=function(t){if(null!==this.L&&0!==this.L._.length&&null!==this.L.v){var i=Math.ceil(this.L.Fn*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.L.Fn*t)-i;this.Uh=new Array(this.L.v.to-this.L.v.from);for(var h=this.L.v.from;h<this.L.v.to;h++){var s,r=this.L._[h],u=Math.round(r.x*t),e=void 0,o=void 0;if(n%2)e=u-(s=(n-1)/2),o=u+s;else e=u-(s=n/2),o=u+s-1;this.Uh[h-this.L.v.from]={Yh:e,Kh:o,$h:u,Xh:r.x*t,at:r.time}}for(h=this.L.v.from+1;h<this.L.v.to;h++){var a=this.Uh[h-this.L.v.from],f=this.Uh[h-this.L.v.from-1];a.at===f.at+1&&(a.Yh-f.Kh!==i+1&&(f.$h>f.Xh?f.Kh=a.Yh-i-1:a.Yh=f.Kh+i+1))}var l=Math.ceil(this.L.Fn*t);for(h=this.L.v.from;h<this.L.v.to;h++){(a=this.Uh[h-this.L.v.from]).Kh<a.Yh&&(a.Kh=a.Yh);var c=a.Kh-a.Yh+1;l=Math.min(c,l)}if(i>0&&l<4)for(h=this.L.v.from;h<this.L.v.to;h++){(c=(a=this.Uh[h-this.L.v.from]).Kh-a.Yh+1)>l&&(a.$h>a.Xh?a.Kh-=1:a.Yh+=1)}}else this.Uh=[]},t}();function hi(t){return{_:[],Fn:t,Hh:NaN,v:null}}function si(t,i,n){return{time:t,price:i,x:NaN,y:NaN,R:n}}var ri=function(t){function i(i,n){var h=t.call(this,i,n,!1)||this;return h.p=new g,h.Zh=hi(0),h.q=new ni,h}return r(i,t),i.prototype.renderer=function(t,i){return this.wh.visible()?(this.mh(),this.p):null},i.prototype.gh=function(){var t=this.Mh.timeScale().barSpacing();this.Zh=hi(t);for(var i=0,n=0,h=this.wh.options().color,s=0,r=this.wh.bars().rows();s<r.length;s++){var u=r[s],e=u.value[3],o=void 0!==u.color?u.color:h,a=si(u.index,e,o);++i<this.Zh._.length?this.Zh._[i]=a:this.Zh._.push(a),this.dh[n++]={time:u.index,x:0}}this.q.l(this.Zh),this.p.i([this.q])},i.prototype.yh=function(){t.prototype.yh.call(this),this.Zh.v=null},i.prototype.kh=function(t,i,n){if(null!==this._h){var h=i.barSpacing(),s=f(i.visibleStrictRange()),r=t.priceToCoordinate(this.wh.options().base,n);i.indexesToCoordinates(this.Zh._),t.pointsArrayToCoordinates(this.Zh._,n),this.Zh.Hh=r,this.Zh.v=Kt(this.Zh._,s,!1),this.Zh.Fn=h,this.q.l(this.Zh)}},i}($t),ui=function(t){function i(i,n){var h=t.call(this,i,n)||this;return h.Ch=new jt,h}return r(i,t),i.prototype.renderer=function(t,i){if(!this.wh.visible())return null;var n=this.wh.options();this.mh();var h={_:this.dh,g:n.color,j:n.lineStyle,eh:n.lineType,W:n.lineWidth,v:this._h,rh:this.Mh.timeScale().barSpacing()};return this.Ch.l(h),this.Ch},i.prototype.Nh=function(t,i){return this.xh(t,i)},i}(Xt),ei=/[2-9]/g,oi=function(){function t(t){void 0===t&&(t=50),this.$i=new Map,this.Jh=0,this.Gh=Array.from(new Array(t))}return t.prototype.reset=function(){this.$i.clear(),this.Gh.fill(void 0)},t.prototype.measureText=function(t,i,n){var h=n||ei,s=String(i).replace(h,"0"),r=this.$i.get(s);if(void 0===r){if(0===(r=t.measureText(s).width)&&0!==i.length)return 0;var u=this.Gh[this.Jh];void 0!==u&&this.$i.delete(u),this.Gh[this.Jh]=s,this.Jh=(this.Jh+1)%this.Gh.length,this.$i.set(s,r)}return r},t}(),ai=function(){function t(t){this.Qh=null,this.$n=null,this.ts="right",this.ln=0,this.ns=t}return t.prototype.hs=function(t,i,n,h){this.Qh=t,this.$n=i,this.ln=n,this.ts=h},t.prototype.draw=function(t,i){null!==this.$n&&null!==this.Qh&&this.Qh.draw(t,this.$n,this.ns,this.ln,this.ts,i)},t}(),fi=function(){function t(t,i,n){this.ss=t,this.ns=new oi(50),this.rs=i,this.C=n,this.Xn=-1,this.q=new ai(this.ns)}return t.prototype.renderer=function(t,i){var n=this.C.paneForSource(this.rs);if(null===n)return null;var h=n.isOverlay(this.rs)?n.defaultPriceScale():this.rs.priceScale();if(null===h)return null;var s=n.priceScalePosition(h);if("overlay"===s)return null;var r=this.C.priceAxisRendererOptions();return r.fontSize!==this.Xn&&(this.Xn=r.fontSize,this.ns.reset()),this.q.hs(this.ss.paneRenderer(),r,i,s),this.q},t}(),li=function(){function t(){this.L=null}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,s,r){if(null!==this.L&&!1!==this.L.B){var u=Math.round(this.L.P*i);if(!(u<0||u>Math.ceil(this.L.us*i))){var e=Math.ceil(this.L.es*i);t.lineCap="butt",t.strokeStyle=this.L.R,t.lineWidth=Math.floor(this.L.W*i),n(t,this.L.j),h(t,u,0,e)}}},t}(),ci=function(){function t(t){this.os={es:0,us:0,P:0,R:"rgba(0, 0, 0, 0)",W:1,j:0,B:!1},this.fs=new li,this.S=!0,this.wh=t,this.Mh=t.model(),this.fs.l(this.os)}return t.prototype.Y=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.wh.visible()?(this.S&&(this.ls(t,i),this.S=!1),this.fs):null},t}(),vi=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype.ls=function(t,i){this.os.B=!1;var n=this.wh.priceScale(),h=n.mode().mode;if(2===h||3===h){var s=this.wh.options();if(s.baseLineVisible&&this.wh.visible()){var r=this.wh.firstValue();null!==r&&(this.os.B=!0,this.os.P=n.priceToCoordinate(r.value,r.value),this.os.es=i,this.os.us=t,this.os.R=s.baseLineColor,this.os.W=s.baseLineWidth,this.os.j=s.baseLineStyle)}}},i}(ci);function di(t,i){return nt(Math.min(Math.max(t,12),30)*i)}function _i(t,i){switch(t){case"arrowDown":case"arrowUp":return di(i,1);case"circle":return di(i,.8);case"square":return di(i,.7)}}function wi(t){return it(di(t,1))}function Mi(t){return Math.max(di(t,.1),3)}function bi(t,i,n,h,s){var r=_i("square",n),u=(r-1)/2,e=t-u,o=i-u;return h>=e&&h<=e+r&&s>=o&&s<=o+r}function mi(t,i,n,h,s){var r=(_i("arrowUp",s)-1)/2,u=(nt(s/2)-1)/2;i.beginPath(),t?(i.moveTo(n-r,h),i.lineTo(n,h-r),i.lineTo(n+r,h),i.lineTo(n+u,h),i.lineTo(n+u,h+r),i.lineTo(n-u,h+r),i.lineTo(n-u,h)):(i.moveTo(n-r,h),i.lineTo(n,h+r),i.lineTo(n+r,h),i.lineTo(n+u,h),i.lineTo(n+u,h-r),i.lineTo(n-u,h-r),i.lineTo(n-u,h)),i.fill()}function gi(t,i,n,h,s,r){return bi(i,n,h,s,r)}var pi=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.L=null,i.ns=new oi,i.Xn=-1,i.Zn="",i.cs="",i}return r(i,t),i.prototype.l=function(t){this.L=t},i.prototype.hs=function(t,i){this.Xn===t&&this.Zn===i||(this.Xn=t,this.Zn=i,this.cs=Vt(t,i),this.ns.reset())},i.prototype.hitTest=function(t,i){if(null===this.L||null===this.L.v)return null;for(var n=this.L.v.from;n<this.L.v.to;n++){var h=this.L._[n];if(ki(h,t,i))return{hitTestData:h.vs,externalId:h.ds}}return null},i.prototype.h=function(t,i,n){if(null!==this.L&&null!==this.L.v){t.textBaseline="middle",t.font=this.cs;for(var h=this.L.v.from;h<this.L.v.to;h++){var s=this.L._[h];void 0!==s._s&&(s._s.es=this.ns.measureText(t,s._s.ws),s._s.us=this.Xn),yi(s,t)}}},i}(p);function yi(t,i){i.fillStyle=t.R,void 0!==t._s&&function(t,i,n,h){t.fillText(i,n,h)}(i,t._s.ws,t.x-t._s.es/2,t._s.P),function(t,i){if(0===t.Ms)return;switch(t.bs){case"arrowDown":return void mi(!1,i,t.x,t.P,t.Ms);case"arrowUp":return void mi(!0,i,t.x,t.P,t.Ms);case"circle":return void function(t,i,n,h){var s=(_i("circle",h)-1)/2;t.beginPath(),t.arc(i,n,s,0,2*Math.PI,!1),t.fill()}(i,t.x,t.P,t.Ms);case"square":return void function(t,i,n,h){var s=_i("square",h),r=(s-1)/2,u=i-r,e=n-r;t.fillRect(u,e,s,s)}(i,t.x,t.P,t.Ms)}t.bs}(t,i)}function ki(t,i,n){return!(void 0===t._s||!function(t,i,n,h,s,r){var u=h/2;return s>=t&&s<=t+n&&r>=i-u&&r<=i+u}(t.x,t._s.P,t._s.es,t._s.us,i,n))||function(t,i,n){if(0===t.Ms)return!1;switch(t.bs){case"arrowDown":case"arrowUp":return gi(0,t.x,t.P,t.Ms,i,n);case"circle":return function(t,i,n,h,s){var r=2+_i("circle",n)/2,u=t-h,e=i-s;return Math.sqrt(u*u+e*e)<=r}(t.x,t.P,t.Ms,i,n);case"square":return bi(t.x,t.P,t.Ms,i,n)}t.bs}(t,i,n)}function xi(t,i,n,h,s,r,u,e,o){var a=v(n)?n:n.close,f=v(n)?n:n.high,l=v(n)?n:n.low,c=v(i.size)?Math.max(i.size,0):1,d=wi(e.barSpacing())*c,_=d/2;switch(t.Ms=d,i.position){case"inBar":return t.P=u.priceToCoordinate(a,o),void(void 0!==t._s&&(t._s.P=t.P+_+r+.6*s));case"aboveBar":return t.P=u.priceToCoordinate(f,o)-_-h.gs,void 0!==t._s&&(t._s.P=t.P-_-.6*s,h.gs+=1.2*s),void(h.gs+=d+r);case"belowBar":return t.P=u.priceToCoordinate(l,o)+_+h.ps,void 0!==t._s&&(t._s.P=t.P+_+r+.6*s,h.ps+=1.2*s),void(h.ps+=d+r)}i.position}var Ni=function(){function t(t,i){this.S=!0,this.ys=!0,this.ks=!0,this.xs=null,this.q=new pi,this.Ns=t,this.ot=i,this.L={_:[],v:null}}return t.prototype.update=function(t){this.S=!0,this.ks=!0,"data"===t&&(this.ys=!0)},t.prototype.renderer=function(t,i,n){if(!this.Ns.visible())return null;this.S&&this.mh();var h=this.ot.options().layout;return this.q.hs(h.fontSize,h.fontFamily),this.q.l(this.L),this.q},t.prototype.Ss=function(){if(this.ks){if(this.Ns.indexedMarkers().length>0){var t=this.ot.timeScale().barSpacing(),i=Mi(t),n=1.5*wi(t)+2*i;this.xs={above:n,below:n}}else this.xs=null;this.ks=!1}return this.xs},t.prototype.mh=function(){var t=this.Ns.priceScale(),i=this.ot.timeScale(),n=this.Ns.indexedMarkers();this.ys&&(this.L._=n.map((function(t){return{time:t.time,x:0,P:0,Ms:0,bs:t.shape,R:t.color,vs:t.internalId,ds:t.id,_s:void 0}})),this.ys=!1);var h=this.ot.options().layout;this.L.v=null;var s=i.visibleStrictRange();if(null!==s){var r=this.Ns.firstValue();if(null!==r&&0!==this.L._.length){var u=NaN,e=Mi(i.barSpacing()),o={gs:e,ps:e};this.L.v=Kt(this.L._,s,!0);for(var a=this.L.v.from;a<this.L.v.to;a++){var f=n[a];f.time!==u&&(o.gs=e,o.ps=e,u=f.time);var l=this.L._[a];l.x=i.indexToCoordinate(f.time),void 0!==f.text&&f.text.length>0&&(l._s={ws:f.text,P:0,es:0,us:0});var c=this.Ns.dataAt(f.time);null!==c&&xi(l,f,c,o,h.fontSize,e,t,i,r.value)}this.S=!1}}},t}(),Si=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype.ls=function(t,i){var n=this.os;n.B=!1;var h=this.wh.options();if(h.priceLineVisible&&this.wh.visible()){var s=this.wh.lastValueData(0===h.priceLineSource);s.noData||(n.B=!0,n.P=s.coordinate,n.R=this.wh.priceLineColor(s.color),n.es=i,n.us=t,n.W=h.priceLineWidth,n.j=h.priceLineStyle)}},i}(ci),Ci=function(t){function i(i){var n=t.call(this)||this;return n.H=i,n}return r(i,t),i.prototype.ht=function(t,i,n){if(t.visible=!1,i.visible=!1,this.H.visible()){var h=this.H.options(),s=h.lastValueVisible,r=""!==this.H.title(),u=0===h.seriesLastValueMode,e=this.H.lastValueData(!1);if(!e.noData){s&&(t.text=this.Cs(e,s,u),t.visible=0!==t.text.length),(r||u)&&(i.text=this.Ds(e,s,r,u),i.visible=i.text.length>0);var o=this.H.priceLineColor(e.color),a=A(o);n.background=a.K,n.color=a.$,n.coordinate=e.coordinate,i.borderColor=this.H.model().options().layout.backgroundColor,t.borderColor=o}}},i.prototype.Ds=function(t,i,n,h){var s="",r=this.H.title();return n&&0!==r.length&&(s+=r+" "),i&&h&&(s+=this.H.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),s.trim()},i.prototype.Cs=function(t,i,n){return i?n?this.H.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(I),Di=function(){function t(t,i){this.ri=t,this.Ts=i||null}return t.prototype.priceRange=function(){return this.ri},t.prototype.margins=function(){return this.Ts},t.prototype.toRaw=function(){return null===this.ri?null:{priceRange:this.ri.toRaw(),margins:this.Ts||void 0}},t.fromRaw=function(i){return null===i?null:new t(J.fromRaw(i.priceRange),i.margins)},t}(),Ti=function(t){function i(i,n){var h=t.call(this,i)||this;return h.Ls=n,h}return r(i,t),i.prototype.ls=function(t,i){var n=this.os;if(n.B=!1,this.wh.visible()){var h=this.Ls.yCoord();if(null!==h){var s=this.Ls.options();n.B=!0,n.P=h,n.R=s.color,n.es=i,n.us=t,n.W=s.lineWidth,n.j=s.lineStyle}}},i}(ci),Li=function(t){function i(i,n){var h=t.call(this)||this;return h.Ns=i,h.Ls=n,h}return r(i,t),i.prototype.ht=function(t,i,n){t.visible=!1,i.visible=!1;var h=this.Ls.options(),s=h.axisLabelVisible,r=""!==h.title;if(s&&this.Ns.visible()){var u=this.Ls.yCoord();if(null!==u){r&&(i.text=h.title,i.visible=!0),i.borderColor=this.Ns.model().options().layout.backgroundColor,t.text=this.Ns.priceScale().formatPriceAbsolute(h.price),t.visible=!0;var e=A(h.color);n.background=e.K,n.color=e.$,n.coordinate=u}}},i}(I),Ei=function(){function t(t,i){this.Ns=t,this.kt=i,this.Es=new Ti(t,this),this.ss=new Li(t,this),this.Bs=new fi(this.ss,t,t.model())}return t.prototype.applyOptions=function(t){c(this.kt,t),this.update(),this.Ns.model().lightUpdate()},t.prototype.options=function(){return this.kt},t.prototype.paneViews=function(){return[this.Es,this.Bs]},t.prototype.priceAxisView=function(){return this.ss},t.prototype.update=function(){this.Es.Y(),this.ss.update()},t.prototype.yCoord=function(){var t=this.Ns,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;var n=t.firstValue();return null===n?null:i.priceToCoordinate(this.kt.price,n.value)},t}(),Bi=function(t){function i(i){var n=t.call(this)||this;return n.ot=i,n}return r(i,t),i.prototype.model=function(){return this.ot},i}(q),Ai={barColor:"",barBorderColor:"",barWickColor:""},Oi=function(){function t(t){this.Ns=t}return t.prototype.barStyle=function(t,i){var n=this.Ns.seriesType(),h=this.Ns.options();switch(n){case"Line":return this.As(h);case"Area":return this.Os(h);case"Bar":return this.Vs(h,t,i);case"Candlestick":return this.Ps(h,t,i);case"Histogram":return this.zs(h,t,i)}throw new Error("Unknown chart style")},t.prototype.Vs=function(t,i,n){var h=u({},Ai),s=t.upColor,r=t.downColor,e=s,o=r,a=f(this.Fs(i,n)),c=l(a.value[0])<=l(a.value[3]);return h.barColor=c?s:r,h.barBorderColor=c?e:o,h},t.prototype.Ps=function(t,i,n){var h=u({},Ai),s=t.upColor,r=t.downColor,e=t.borderUpColor,o=t.borderDownColor,a=t.wickUpColor,c=t.wickDownColor,v=f(this.Fs(i,n)),d=l(v.value[0])<=l(v.value[3]);return h.barColor=d?s:r,h.barBorderColor=d?e:o,h.barWickColor=d?a:c,h},t.prototype.Os=function(t){return u(u({},Ai),{barColor:t.lineColor})},t.prototype.As=function(t){return u(u({},Ai),{barColor:t.color})},t.prototype.zs=function(t,i,n){var h=u({},Ai),s=f(this.Fs(i,n));return h.barColor=void 0!==s.color?s.color:t.color,h},t.prototype.Fs=function(t,i){return void 0!==i?i.value:this.Ns.bars().valueAt(t)},t}(),Vi=30,Pi=function(){function t(){this.Is=[],this.Ws=new Map,this.Rs=new Map}return t.prototype.clear=function(){this.Is=[],this.Ws.clear(),this.Rs.clear()},t.prototype.last=function(){return this.size()>0?this.Is[this.Is.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.js(0):null},t.prototype.lastIndex=function(){return this.size()>0?this.js(this.Is.length-1):null},t.prototype.size=function(){return this.Is.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Us(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,i){void 0===i&&(i=0);var n=this.Us(t,i);return null===n?null:u(u({},this.qs(n)),{index:this.js(n)})},t.prototype.rows=function(){return this.Is},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var h=null,s=0,r=n;s<r.length;s++){var u=r[s];h=zi(h,this.Hs(t,i,u))}return h},t.prototype.merge=function(t){0!==t.length&&(this.isEmpty()||t[t.length-1].index<this.Is[0].index?this.Ys(t):t[0].index>this.Is[this.Is.length-1].index?this.Ks(t):1!==t.length||t[0].index!==this.Is[this.Is.length-1].index?this.$s(t):this.Xs(t[0]))},t.prototype.js=function(t){return this.Is[t].index},t.prototype.qs=function(t){return this.Is[t]},t.prototype.Us=function(t,i){var n=this.Zs(t);if(null===n&&0!==i)switch(i){case-1:return this.Js(t);case 1:return this.Gs(t);default:throw new TypeError("Unknown search mode")}return n},t.prototype.Js=function(t){var i=this.Qs(t);return i>0&&(i-=1),i!==this.Is.length&&this.js(i)<t?i:null},t.prototype.Gs=function(t){var i=this.tr(t);return i!==this.Is.length&&t<this.js(i)?i:null},t.prototype.Zs=function(t){var i=this.Qs(t);return i===this.Is.length||t<this.Is[i].index?null:i},t.prototype.Qs=function(t){return Ut(this.Is,t,(function(t,i){return t.index<i}))},t.prototype.tr=function(t){return qt(this.Is,t,(function(t,i){return i.index>t}))},t.prototype.ir=function(t,i,n){for(var h=null,s=t;s<i;s++){var r=this.Is[s].value[n];Number.isNaN(r)||(null===h?h={min:r,max:r}:(r<h.min&&(h.min=r),r>h.max&&(h.max=r)))}return h},t.prototype.nr=function(t){var i=Math.floor(t.index/Vi);this.Ws.forEach((function(t){return t.delete(i)}))},t.prototype.Ys=function(t){o(0!==t.length,"plotRows should not be empty"),this.Rs.clear(),this.Ws.clear(),this.Is=t.concat(this.Is)},t.prototype.Ks=function(t){o(0!==t.length,"plotRows should not be empty"),this.Rs.clear(),this.Ws.clear(),this.Is=this.Is.concat(t)},t.prototype.Xs=function(t){o(!this.isEmpty(),"plot list should not be empty"),o(this.Is[this.Is.length-1].index===t.index,"last row index should match new row index"),this.nr(t),this.Rs.delete(t.index),this.Is[this.Is.length-1]=t},t.prototype.$s=function(t){o(0!==t.length,"plot rows should not be empty"),this.Rs.clear(),this.Ws.clear(),this.Is=function(t,i){var n=function(t,i){var n=t.length,h=i.length,s=n+h,r=0,u=0;for(;r<n&&u<h;)t[r].index<i[u].index?r++:t[r].index>i[u].index?u++:(r++,u++,s--);return s}(t,i),h=new Array(n),s=0,r=0,u=t.length,e=i.length,o=0;for(;s<u&&r<e;)t[s].index<i[r].index?(h[o]=t[s],s++):t[s].index>i[r].index?(h[o]=i[r],r++):(h[o]=i[r],s++,r++),o++;for(;s<u;)h[o]=t[s],s++,o++;for(;r<e;)h[o]=i[r],r++,o++;return h}(this.Is,t)},t.prototype.Hs=function(t,i,n){if(this.isEmpty())return null;var h=null,s=f(this.firstIndex()),r=f(this.lastIndex()),u=Math.max(t,s),e=Math.min(i,r),o=Math.ceil(u/Vi)*Vi,a=Math.max(o,Math.floor(e/Vi)*Vi),l=this.Qs(u),c=this.tr(Math.min(e,o,i));h=zi(h,this.ir(l,c,n));var v=this.Ws.get(n);void 0===v&&(v=new Map,this.Ws.set(n,v));for(var d=Math.max(o+1,u);d<a;d+=Vi){var _=Math.floor(d/Vi),w=v.get(_);if(void 0===w){var M=this.Qs(_*Vi),b=this.tr((_+1)*Vi-1);w=this.ir(M,b,n),v.set(_,w)}h=zi(h,w)}l=this.Qs(a),c=this.tr(e);return h=zi(h,this.ir(l,c,n))},t}();function zi(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}var Fi=function(t){function i(i,n,h){var s=t.call(this,i)||this;s.L=new Pi,s.Es=new Si(s),s.hr=[],s.sr=new vi(s),s.rr=null,s.ur=[],s.er=[],s.kt=n,s.ar=h;var r=new Ci(s);return s._t=[r],s.Bs=new fi(r,s,i),s.lr(),s.cr(),s}return r(i,t),i.prototype.destroy=function(){},i.prototype.priceLineColor=function(t){return this.kt.priceLineColor||t},i.prototype.lastValueData=function(t,i){var n={noData:!0},h=this.priceScale();if(this.model().timeScale().isEmpty()||h.isEmpty()||this.L.isEmpty())return n;var s,r,u=this.model().timeScale().visibleStrictRange(),e=this.firstValue();if(null===u||null===e)return n;if(t){var o=this.L.last();if(null===o)return n;s=o,r=o.index}else{var a=this.L.search(u.right(),-1);if(null===a)return n;if(null===(s=this.L.valueAt(a.index)))return n;r=a.index}var f=s.value[3],l=this.barColorer().barStyle(r,{value:s}),c=h.priceToCoordinate(f,e.value);return{noData:!1,price:i?f:void 0,text:h.formatPrice(f,e.value),formattedPriceAbsolute:h.formatPriceAbsolute(f),formattedPricePercentage:h.formatPricePercentage(f,e.value),color:l.barColor,coordinate:c,index:r}},i.prototype.barColorer=function(){return null!==this.rr||(this.rr=new Oi(this)),this.rr},i.prototype.options=function(){return this.kt},i.prototype.applyOptions=function(t){var i=t.priceScaleId;void 0!==i&&i!==this.kt.priceScaleId&&this.model().moveSeriesToScale(this,i),c(this.kt,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&this.lr(),this.model().updateSource(this),this.model().updateCrosshair()},i.prototype.clearData=function(){this.L.clear(),this.cr()},i.prototype.updateData=function(t,i){i&&this.L.clear(),this.L.merge(t),this.vr(),this.Ct.update("data"),this.xt.update("data");var n=this.model().paneForSource(this);this.model().recalculatePane(n),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.ur=t.map((function(t){return u({},t)})),this.vr();var i=this.model().paneForSource(this);this.xt.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.indexedMarkers=function(){return this.er},i.prototype.createPriceLine=function(t){var i=new Ei(this,t);return this.hr.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.hr.indexOf(t);-1!==i&&this.hr.splice(i,1),this.model().updateSource(this)},i.prototype.customPriceLines=function(){return this.hr},i.prototype.seriesType=function(){return this.ar},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var i=t.left();return this.L.search(i,1)},i.prototype.bars=function(){return this.L},i.prototype.dataAt=function(t){var i=this.L.valueAt(t);return null===i?null:"Bar"===this.ar||"Candlestick"===this.ar?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]},i.prototype.paneViews=function(){var t=[];this.dr()||t.push(this.sr);for(var i=0,n=this.hr;i<n.length;i++){var h=n[i];t.push.apply(t,h.paneViews())}return t.push(this.Ct,this.Es,this.Bs,this.xt),t},i.prototype.priceAxisViews=function(t,i){for(var n=i===this._priceScale||this.dr()?e(this._t):[],h=0,s=this.hr;h<s.length;h++){var r=s[h];n.push(r.priceAxisView())}return n},i.prototype.autoscaleInfo=function(t,i){var n=this;if(void 0!==this.kt.autoscaleInfoProvider){var h=this.kt.autoscaleInfoProvider((function(){var h=n._r(t,i);return null===h?null:h.toRaw()}));return Di.fromRaw(h)}return this._r(t,i)},i.prototype.minMove=function(){return this.kt.priceFormat.minMove},i.prototype.formatter=function(){return this.mi},i.prototype.updateAllViews=function(){this.Ct.update(),this.xt.update();for(var t=0,i=this._t;t<i.length;t++){i[t].update()}for(var n=0,h=this.hr;n<h.length;n++){h[n].update()}this.Es.Y(),this.sr.Y()},i.prototype.priceScale=function(){return f(this._priceScale)},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.ar||"Area"===this.ar)&&this.kt.crosshairMarkerVisible))return null;var i=this.L.valueAt(t);return null===i?null:{price:i.value[3],radius:this.wr(),borderColor:this.Mr(),backgroundColor:this.br(t)}},i.prototype.title=function(){return this.kt.title},i.prototype.visible=function(){return this.kt.visible},i.prototype.dr=function(){return!zt(this.priceScale().id())},i.prototype._r=function(t,i){if(!d(t)||!d(i)||this.L.isEmpty())return null;var n="Line"===this.ar||"Area"===this.ar||"Histogram"===this.ar?[3]:[2,1],h=this.L.minMaxOnRangeCached(t,i,n),s=null!==h?new J(h.min,h.max):null;if("Histogram"===this.seriesType()){var r=this.kt.base,u=new J(r,r);s=null!==s?s.merge(u):u}return new Di(s,this.xt.Ss())},i.prototype.wr=function(){switch(this.ar){case"Line":case"Area":return this.kt.crosshairMarkerRadius}return 0},i.prototype.Mr=function(){switch(this.ar){case"Line":case"Area":var t=this.kt.crosshairMarkerBorderColor;if(0!==t.length)return t}return this.model().options().layout.backgroundColor},i.prototype.br=function(t){switch(this.ar){case"Line":case"Area":var i=this.kt.crosshairMarkerBackgroundColor;if(0!==i.length)return i}return this.barColorer().barStyle(t).barColor},i.prototype.lr=function(){switch(this.kt.priceFormat.type){case"custom":this.mi={format:this.kt.priceFormat.formatter};break;case"volume":this.mi=new It(this.kt.priceFormat.precision);break;case"percent":this.mi=new X(this.kt.priceFormat.precision);break;default:var t=Math.pow(10,this.kt.priceFormat.precision);this.mi=new $(t,this.kt.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.vr=function(){var t=this,i=this.model().timeScale();if(i.isEmpty()||0===this.L.size())this.er=[];else{var n=f(this.L.firstIndex());this.er=this.ur.map((function(h,s){var r=f(i.timeToIndex(h.time,!0)),u=r<n?1:-1;return{time:f(t.L.search(r,u)).index,position:h.position,shape:h.shape,color:h.color,id:h.id,internalId:s,text:h.text,size:h.size}}))}},i.prototype.cr=function(){switch(this.xt=new Ni(this,this.model()),this.ar){case"Bar":this.Ct=new Qt(this,this.model());break;case"Candlestick":this.Ct=new ii(this,this.model());break;case"Line":this.Ct=new ui(this,this.model());break;case"Area":this.Ct=new Zt(this,this.model());break;case"Histogram":this.Ct=new ri(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.ar)}},i}(Bi),Ii=function(){function t(t){this.kt=t}return t.prototype.mr=function(t,i,n){var h=t;if(0===this.kt.mode)return h;var s=n.defaultPriceScale(),r=s.firstValue();if(null===r)return h;var u=s.priceToCoordinate(t,r),e=n.dataSources().filter((function(t){return t instanceof Fi})).reduce((function(t,h){if(n.isOverlay(h)||!h.visible())return t;var s=h.priceScale(),r=h.bars();if(s.isEmpty()||!r.contains(i))return t;var u=r.valueAt(i);if(null===u)return t;var e=l(h.firstValue());return t.concat([s.priceToCoordinate(u.value[3],e.value)])}),[]);if(0===e.length)return h;e.sort((function(t,i){return Math.abs(t-u)-Math.abs(i-u)}));var o=e[0];return h=s.coordinateToPrice(o,r)},t}(),Wi=function(){function t(){this.L=null}return t.prototype.l=function(t){this.L=t},t.prototype.draw=function(t,i,h,s){var r=this;if(null!==this.L){var u=Math.max(1,Math.floor(i));t.lineWidth=u;var e=Math.ceil(this.L.I*i),o=Math.ceil(this.L.F*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(function(){var h=f(r.L);if(h.gr){t.strokeStyle=h.pr,n(t,h.yr),t.beginPath();for(var s=0,a=h.kr;s<a.length;s++){var l=a[s],c=Math.round(l.Nr*i);t.moveTo(c,-u),t.lineTo(c,e+u)}t.stroke()}if(h.Sr){t.strokeStyle=h.Cr,n(t,h.Dr),t.beginPath();for(var v=0,d=h.Tr;v<d.length;v++){var _=d[v],w=Math.round(_.coord*i);t.moveTo(-u,w),t.lineTo(o+u,w)}t.stroke()}}))}},t}(),Ri=function(){function t(t){this.q=new Wi,this.S=!0,this.lt=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){if(this.S){var n=this.lt.model().options().grid,h={I:t,F:i,Sr:n.horzLines.visible,gr:n.vertLines.visible,Cr:n.horzLines.color,pr:n.vertLines.color,Dr:n.horzLines.style,yr:n.vertLines.style,Tr:this.lt.defaultPriceScale().marks(),kr:this.lt.model().timeScale().marks()||[]};this.q.l(h),this.S=!1}return this.q},t}(),ji=function(){function t(t){this.Ct=new Ri(t)}return t.prototype.paneView=function(){return this.Ct},t}(),Ui=function(){function t(t,i){this.di=[],this.Lr=new Map,this.hi=0,this.ln=0,this.Er=1e3,this._i=null,this.Br=new Z,this.Ar=t,this.ot=i,this.Or=new ji(this);var n=i.options();this.Vr=this.Pr("left",n.leftPriceScale),this.zr=this.Pr("right",n.rightPriceScale),this.Vr.modeChanged().subscribe(this.Fr.bind(this,this.Vr),this),this.zr.modeChanged().subscribe(this.Fr.bind(this,this.Vr),this),this.applyScaleOptions(n)}return t.prototype.applyScaleOptions=function(t){if(t.leftPriceScale&&this.Vr.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.zr.applyOptions(t.rightPriceScale),t.localization&&(this.Vr.updateFormatter(),this.zr.updateFormatter()),t.overlayPriceScales)for(var i=0,n=Array.from(this.Lr.values());i<n.length;i++){var h=f(n[i][0].priceScale());h.applyOptions(t.overlayPriceScales),t.localization&&h.updateFormatter()}},t.prototype.priceScaleById=function(t){switch(t){case"left":return this.Vr;case"right":return this.zr}return this.Lr.has(t)?a(this.Lr.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.Vr.modeChanged().unsubscribeAll(this),this.zr.modeChanged().unsubscribeAll(this),this.di.forEach((function(t){t.destroy&&t.destroy()})),this.Br.Rt()},t.prototype.stretchFactor=function(){return this.Er},t.prototype.setStretchFactor=function(t){this.Er=t},t.prototype.model=function(){return this.ot},t.prototype.width=function(){return this.ln},t.prototype.height=function(){return this.hi},t.prototype.setWidth=function(t){this.ln=t,this.updateAllSources()},t.prototype.setHeight=function(t){var i=this;this.hi=t,this.Vr.setHeight(t),this.zr.setHeight(t),this.di.forEach((function(n){if(i.isOverlay(n)){var h=n.priceScale();null!==h&&h.setHeight(t)}})),this.updateAllSources()},t.prototype.dataSources=function(){return this.di},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.Vr!==i&&this.zr!==i},t.prototype.addDataSource=function(t,i,n){var h=void 0!==n?n:this.Wr().Ir-1;this.Rr(t,i,h)},t.prototype.removeDataSource=function(t){var i=this.di.indexOf(t);o(-1!==i,"removeDataSource: invalid data source"),this.di.splice(i,1);var n=f(t.priceScale()).id();if(this.Lr.has(n)){var h=a(this.Lr.get(n)),s=h.indexOf(t);-1!==s&&(h.splice(s,1),0===h.length&&this.Lr.delete(n))}var r=t.priceScale();r&&r.dataSources().indexOf(t)>=0&&r.removeDataSource(t),null!==r&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this._i=null},t.prototype.priceScalePosition=function(t){return t===this.Vr?"left":t===this.zr?"right":"overlay"},t.prototype.leftPriceScale=function(){return this.Vr},t.prototype.rightPriceScale=function(){return this.zr},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this.di.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=null;return this.ot.options().rightPriceScale.visible&&0!==this.zr.dataSources().length?t=this.zr:this.ot.options().leftPriceScale.visible&&0!==this.Vr.dataSources().length?t=this.Vr:0!==this.di.length&&(t=this.di[0].priceScale()),null===t&&(t=this.zr),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.jr(t)},t.prototype.resetPriceScale=function(t){var i=this.Ar.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this.jr(this.Vr),this.jr(this.zr)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.Vr),this.recalculatePriceScale(this.zr),this.di.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllSources(),this.ot.lightUpdate()},t.prototype.orderedSources=function(){return null===this._i&&(this._i=vt(this.di)),this._i},t.prototype.onDestroyed=function(){return this.Br},t.prototype.grid=function(){return this.Or},t.prototype.jr=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.Ar.isEmpty()){var n=this.Ar.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.Wr=function(){var t=this.orderedSources();if(0===t.length)return{Ir:0,Ur:0};for(var i=0,n=0,h=0;h<t.length;h++){var s=t[h].zorder();null!==s&&(s<i&&(i=s),s>n&&(n=s))}return{Ir:i,Ur:n}},t.prototype.Rr=function(t,i,n){var h=this.priceScaleById(i);if(null===h&&(h=this.Pr(i,this.ot.options().overlayPriceScales)),this.di.push(t),!zt(i)){var s=this.Lr.get(i)||[];s.push(t),this.Lr.set(i,s)}h.addDataSource(t),t.setPriceScale(h),t.setZorder(n),this.recalculatePriceScale(h),this._i=null},t.prototype.Fr=function(t,i,n){i.mode!==n.mode&&this.jr(t)},t.prototype.Pr=function(t,i){var n=u({visible:!0,autoScale:!0},M(i)),h=new Mt(t,n,this.ot.options().layout,this.ot.options().localization);return h.setHeight(this.height()),h},t}(),qi=function(t){function i(i){var n=t.call(this)||this;return n.qr=new Map,n.L=i,n}return r(i,t),i.prototype.h=function(t){},i.prototype.u=function(t){if(this.L.B){t.save();for(var i=0,n=0,h=this.L.Hr;n<h.length;n++){if(0!==(o=h[n])._s.length){t.font=o.Yr;var s=this.Kr(t,o._s);s>this.L.es?o.$r=this.L.es/s:o.$r=1,i+=o.Xr*o.$r}}var r=0;switch(this.L.Zr){case"top":r=0;break;case"center":r=Math.max((this.L.us-i)/2,0);break;case"bottom":r=Math.max(this.L.us-i,0)}t.fillStyle=this.L.R;for(var u=0,e=this.L.Hr;u<e.length;u++){var o=e[u];t.save();var a=0;switch(this.L.Jr){case"left":t.textAlign="left",a=o.Xr/2;break;case"center":t.textAlign="center",a=this.L.es/2;break;case"right":t.textAlign="right",a=this.L.es-1-o.Xr/2}t.translate(a,r),t.textBaseline="top",t.font=o.Yr,t.scale(o.$r,o.$r),t.fillText(o._s,0,o.Gr),t.restore(),r+=o.Xr*o.$r}t.restore()}},i.prototype.Kr=function(t,i){var n=this.Qr(t.font),h=n.get(i);return void 0===h&&(h=t.measureText(i).width,n.set(i,h)),h},i.prototype.Qr=function(t){var i=this.qr.get(t);return void 0===i&&(i=new Map,this.qr.set(t,i)),i},i}(p),Hi=function(){function t(t){this.S=!0,this.U={B:!1,R:"",us:0,es:0,Hr:[],Zr:"center",Jr:"center"},this.q=new qi(this.U),this.H=t}return t.prototype.update=function(){this.S=!0},t.prototype.renderer=function(t,i){return this.S&&(this.T(t,i),this.S=!1),this.q},t.prototype.T=function(t,i){var n=this.H.options(),h=this.U;h.B=n.visible,h.B&&(h.R=n.color,h.es=i,h.us=t,h.Jr=n.horzAlign,h.Zr=n.vertAlign,h.Hr=[{_s:n.text,Yr:Vt(n.fontSize,n.fontFamily,n.fontStyle),Xr:1.2*n.fontSize,Gr:0,$r:0}])},t}(),Yi=function(t){function i(i,n){var h=t.call(this)||this;return h.kt=n,h.Ct=new Hi(h),h}return r(i,t),i.prototype.paneViews=function(){return[this.Ct]},i.prototype.options=function(){return this.kt},i.prototype.updateAllViews=function(){this.Ct.update()},i}(q),Ki=function(){function t(t,i){this.tu=[],this.iu=[],this.ln=0,this.nu=null,this.hu=null,this.su=new Z,this.ru=new Z,this.uu=new Z,this.eu=t,this.kt=i,this.ou=new Pt(this),this.Ar=new Et(this,i.timeScale,this.kt.localization),this.D=new H(this,i.crosshair),this.au=new Ii(i.crosshair),this.fu=new Yi(this,i.watermark),this.createPane(),this.tu[0].setStretchFactor(2e3)}return t.prototype.fullUpdate=function(){this.lu(new Ft(3))},t.prototype.lightUpdate=function(){this.lu(new Ft(2))},t.prototype.updateSource=function(t){var i=this.cu(t);this.lu(i)},t.prototype.hoveredSource=function(){return this.hu},t.prototype.setHoveredSource=function(t){var i=this.hu;this.hu=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.kt},t.prototype.applyOptions=function(t){c(this.kt,t),this.tu.forEach((function(i){return i.applyScaleOptions(t)})),void 0!==t.timeScale&&this.Ar.applyOptions(t.timeScale),void 0!==t.localization&&this.Ar.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.su.Rt(),this.fullUpdate()},t.prototype.applyPriceScaleOptions=function(t,i){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(i),this.su.Rt())},t.prototype.findPriceScale=function(t){for(var i=0,n=this.tu;i<n.length;i++){var h=n[i],s=h.priceScaleById(t);if(null!==s)return{pane:h,priceScale:s}}return null},t.prototype.timeScale=function(){return this.Ar},t.prototype.panes=function(){return this.tu},t.prototype.watermarkSource=function(){return this.fu},t.prototype.crosshairSource=function(){return this.D},t.prototype.crosshairMoved=function(){return this.ru},t.prototype.customPriceLineDragged=function(){return this.uu},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this.ln=t,this.Ar.setWidth(this.ln),this.tu.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new Ui(this.Ar,this);void 0!==t?this.tu.splice(t,0,i):this.tu.push(i);var n=void 0===t?this.tu.length-1:t,h=new Ft(3);return h.invalidatePane(n,{level:0,autoScale:!0}),this.lu(h),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.lu(this.vu(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.lu(this.vu(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.lu(this.vu(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.lu(this.vu(t,2)))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.lu(this.vu(t,2))},t.prototype.startScaleTime=function(t){this.Ar.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var h=n.width();t=Math.max(1,Math.min(t,h)),n.zoom(t,i),this.recalculateAllPanes()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.Ar.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this.Ar.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.nu=t,this.Ar.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.nu&&Math.abs(t-this.nu)>20&&(this.nu=null,i=!0),this.Ar.scrollTo(t),this.recalculateAllPanes(),i},t.prototype.endScrollTime=function(){this.Ar.endScroll(),this.lightUpdate(),this.nu=null},t.prototype.serieses=function(){return this.iu},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.D.saveOriginCoord(t,i);var h=NaN,s=this.Ar.coordinateToIndex(t),r=this.Ar.visibleStrictRange();null!==r&&(s=Math.min(Math.max(r.left(),s),r.right()));var u=n.defaultPriceScale(),e=u.firstValue();null!==e&&(h=u.coordinateToPrice(i,e)),h=this.au.mr(h,s,n),this.D.setPosition(s,h,n),this.du(),this.ru.Rt(this.D.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.du(),this.ru.Rt(null,null)},t.prototype.updateCrosshair=function(){var t=this.D.pane();if(null!==t){var i=this.D.originCoordX(),n=this.D.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}this.D.updateAllViews()},t.prototype.setAndSaveCurrentPositionFire=function(t,i,n,h){this.D.saveOriginCoord(t,i);var s=NaN,r=this.Ar.coordinateToIndex(t),u=this.Ar.visibleStrictRange();null!==u&&(r=Math.min(Math.max(u.left(),r),u.right()));var e=h.defaultPriceScale(),o=e.firstValue();null!==o&&(s=e.coordinateToPrice(i,o)),s=this.au.mr(s,r,h),this.D.setPosition(r,s,h),this.du(),n&&this.ru.Rt(this.D.appliedIndex(),{x:t,y:i})},t.prototype.updateTimeScale=function(t,i){var n=this.Ar.indexToTime(0);void 0!==i&&this.Ar.update(i);var h=this.Ar.indexToTime(0),s=this.Ar.baseIndex(),r=this.Ar.visibleStrictRange();if(null!==r&&null!==n&&null!==h){var u=r.contains(s),e=n.timestamp>h.timestamp,o=t>s&&!e,a=u&&this.Ar.options().shiftVisibleRangeOnNewBar;if(o&&!a){var f=t-s;this.Ar.setRightOffset(this.Ar.rightOffset()-f)}}this.Ar.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.tu.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.fu.updateAllViews(),this.tu.forEach((function(t){return t.recalculate()})),this.updateCrosshair()},t.prototype.fireCustomPriceLineDragged=function(t,i){this.uu.Rt(t,i)},t.prototype.destroy=function(){this.tu.forEach((function(t){return t.destroy()})),this.tu.length=0,this.kt.localization.priceFormatter=void 0,this.kt.localization.timeFormatter=void 0},t.prototype.rendererOptionsProvider=function(){return this.ou},t.prototype.priceAxisRendererOptions=function(){return this.ou.options()},t.prototype.priceScalesOptionsChanged=function(){return this.su},t.prototype.createSeries=function(t,i){var n=this.tu[0],h=this._u(i,t,n);return this.iu.push(h),1===this.iu.length?this.fullUpdate():this.lightUpdate(),h},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.iu.indexOf(t);o(-1!==n,"Series not found"),this.iu.splice(n,1),f(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.moveSeriesToScale=function(t,i){var n=f(this.paneForSource(t));n.removeDataSource(t);var h=this.findPriceScale(i);if(null===h){var s=t.zorder();n.addDataSource(t,i,s)}else{s=h.pane===n?t.zorder():void 0;h.pane.addDataSource(t,i,s)}},t.prototype.fitContent=function(){var t=new Ft(2);t.setFitContent(),this.lu(t)},t.prototype.setTargetLogicalRange=function(t){var i=new Ft(2);i.applyRange(t),this.lu(i)},t.prototype.resetTimeScale=function(){var t=new Ft(2);t.resetTimeScale(),this.lu(t)},t.prototype.setBarSpacing=function(t){var i=new Ft(2);i.setBarSpacing(t),this.lu(i)},t.prototype.setRightOffset=function(t){var i=new Ft(2);i.setRightOffset(t),this.lu(i)},t.prototype.defaultVisiblePriceScaleId=function(){return this.kt.rightPriceScale.visible?"right":"left"},t.prototype.vu=function(t,i){var n=new Ft(i);if(null!==t){var h=this.tu.indexOf(t);n.invalidatePane(h,{level:i})}return n},t.prototype.cu=function(t,i){return void 0===i&&(i=2),this.vu(this.paneForSource(t),i)},t.prototype.lu=function(t){this.eu&&this.eu(t),this.tu.forEach((function(t){return t.grid().paneView().update()}))},t.prototype.du=function(){this.lu(new Ft(1))},t.prototype._u=function(t,i,n){var h=new Fi(this,t,i),s=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return n.addDataSource(h,s),zt(s)||h.applyOptions(t),h},t}(),$i={allowDownsampling:!0};var Xi=function(){function t(t,i){var n=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return n._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}(),Zi=function(){function t(t,i){this.F=t,this.I=i}return t.prototype.wu=function(t){return this.F===t.F&&this.I===t.I},t}();function Ji(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function Gi(t){var i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function Qi(t,i){var n=t.createElement("canvas"),h=Ji(n);return n.style.width=i.F+"px",n.style.height=i.I+"px",n.width=i.F*h,n.height=i.I*h,n}function tn(t,i){var n=f(t.ownerDocument).createElement("canvas");t.appendChild(n);var h=function(t,i){return void 0===i&&(i=$i),new Xi(t,i)}(n);return h.resizeCanvas({width:i.F,height:i.I}),h}var nn="undefined"!=typeof window;var hn=function(){if(!nn)return!1;var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||!!nn&&("ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch));return"onorientationchange"in window&&t}();var sn=function(){if(!nn)return!1;var t=/Android/i.test(navigator.userAgent),i=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent);return t||i}(),rn=function(){function t(t,i,n){this.Mu=0,this.bu=null,this.mu=null,this.gu=!1,this.pu=null,this.yu=!1,this.ku=!1,this.xu=null,this.Nu=null,this.Su=null,this.Cu=null,this.Du=0,this.Tu=!1,this.Lu=!1,this.Eu=!1,this.Bu=t,this.Au=i,this.kt=n,this.Ou()}return t.prototype.destroy=function(){null!==this.xu&&(this.xu(),this.xu=null),null!==this.Nu&&(this.Nu(),this.Nu=null),null!==this.Su&&(this.Su(),this.Su=null),this.Vu(),this.Pu()},t.prototype.zu=function(t){var i=this;this.Nu&&this.Nu();var n=this.Fu.bind(this);this.Nu=function(){i.Bu.removeEventListener("mousemove",n)},this.Bu.addEventListener("mousemove",n),on(t)&&this.Fu(t);var h=this.Iu(t);this.Wu(h,this.Au.Ru)},t.prototype.Pu=function(){null!==this.bu&&clearTimeout(this.bu),this.Mu=0,this.bu=null},t.prototype.Fu=function(t){if(!this.Eu||on(t)){var i=this.Iu(t);this.Wu(i,this.Au.ju)}},t.prototype.Uu=function(t){if((!("button"in t)||0===t.button)&&null===this.Cu){var i=on(t);if(!this.Lu||!i){this.Tu=!0;var n=this.Iu(t),h=l(this.pu),s=Math.abs(h.V-n.qu),r=Math.abs(h.P-n.Hu),u=s+r>5;if(u||!i){if(u&&!this.yu&&i){var e=.5*s,o=r>=e&&!this.kt.Yu,a=e>r&&!this.kt.Ku;o||a||(this.Lu=!0)}u&&(this.yu=!0,this.ku=!0,i&&this.Vu()),this.Lu||(this.Wu(n,this.Au.$u),i&&an(t))}}}},t.prototype.Xu=function(t){if(!("button"in t)||0===t.button){var i=this.Iu(t);this.Vu(),this.pu=null,this.Eu=!1,this.Su&&(this.Su(),this.Su=null),on(t)&&this.Zu(t),this.Wu(i,this.Au.Ju),++this.Mu,this.bu&&this.Mu>1?(this.Wu(i,this.Au.Gu),this.Pu()):this.ku||this.Wu(i,this.Au.Qu),on(t)&&(an(t),this.Zu(t),0===t.touches.length&&(this.gu=!1))}},t.prototype.Vu=function(){null!==this.mu&&(clearTimeout(this.mu),this.mu=null)},t.prototype.te=function(t){if(!("button"in t)||0===t.button){var i=this.Iu(t);this.ku=!1,this.yu=!1,this.Lu=!1,on(t)&&this.zu(t),this.pu={V:i.qu,P:i.Hu},this.Su&&(this.Su(),this.Su=null);var n=this.Uu.bind(this),h=this.Xu.bind(this),s=this.Bu.ownerDocument.documentElement;this.Su=function(){s.removeEventListener("touchmove",n),s.removeEventListener("touchend",h),s.removeEventListener("mousemove",n),s.removeEventListener("mouseup",h)},s.addEventListener("touchmove",n,{passive:!1}),s.addEventListener("touchend",h,{passive:!1}),this.Vu(),on(t)&&1===t.touches.length?this.mu=setTimeout(this.ie.bind(this,t),240):(s.addEventListener("mousemove",n),s.addEventListener("mouseup",h)),this.Eu=!0,this.Wu(i,this.Au.ne),this.bu||(this.Mu=0,this.bu=setTimeout(this.Pu.bind(this),500))}},t.prototype.Ou=function(){var t=this;this.Bu.addEventListener("mouseenter",this.zu.bind(this)),this.Bu.addEventListener("touchcancel",this.Vu.bind(this));var i=this.Bu.ownerDocument,n=function(i){t.Au.he&&(i.composed&&t.Bu.contains(i.composedPath()[0])||i.target&&t.Bu.contains(i.target)||t.Au.he())};this.xu=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this.Bu.addEventListener("mouseleave",this.Zu.bind(this)),this.Bu.addEventListener("touchstart",this.te.bind(this),{passive:!0}),hn||this.Bu.addEventListener("mousedown",this.te.bind(this)),this.se(),this.Bu.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.se=function(){var t=this;void 0===this.Au.re&&void 0===this.Au.ue&&void 0===this.Au.ee||(this.Bu.addEventListener("touchstart",(function(i){return t.oe(i.touches)}),{passive:!0}),this.Bu.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.Cu&&void 0!==t.Au.ue){var n=en(i.touches[0],i.touches[1])/t.Du;t.Au.ue(t.Cu,n),an(i)}}),{passive:!1}),this.Bu.addEventListener("touchend",(function(i){t.oe(i.touches)})))},t.prototype.oe=function(t){1===t.length&&(this.Tu=!1),2!==t.length||this.Tu||this.gu?this.ae():this.fe(t)},t.prototype.fe=function(t){var i=un(this.Bu);this.Cu={V:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,P:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Du=en(t[0],t[1]),void 0!==this.Au.re&&this.Au.re(),this.Vu()},t.prototype.ae=function(){null!==this.Cu&&(this.Cu=null,void 0!==this.Au.ee&&this.Au.ee())},t.prototype.Zu=function(t){this.Nu&&this.Nu();var i=this.Iu(t);this.Wu(i,this.Au.le)},t.prototype.ie=function(t){var i=this.Iu(t);this.Wu(i,this.Au.ce),this.ku=!0,this.gu=!0},t.prototype.Wu=function(t,i){i&&i.call(this.Au,t)},t.prototype.Iu=function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var n=un(this.Bu);return{ve:i.clientX,de:i.clientY,qu:i.pageX,Hu:i.pageY,_e:i.screenX,we:i.screenY,Me:i.clientX-n.left,be:i.clientY-n.top,me:t.ctrlKey,ge:t.altKey,pe:t.shiftKey,ye:t.metaKey,ke:t.type.startsWith("mouse")?"mouse":"touch",xe:t.view}},t}();function un(t){return t.getBoundingClientRect()||{left:0,top:0}}function en(t,i){var n=t.clientX-i.clientX,h=t.clientY-i.clientY;return Math.sqrt(n*n+h*h)}function on(t){return Boolean(t.touches)}function an(t){t.cancelable&&t.preventDefault()}var fn=function(){function t(t,i,n,h){this.ns=new oi(200),this.Xn=0,this.Ne="",this.cs="",this.Gh=[],this.Se=new Map,this.Xn=t,this.Ne=i,this.cs=Vt(t,n,h)}return t.prototype.destroy=function(){this.ns.reset(),this.Gh=[],this.Se.clear()},t.prototype.Ce=function(t,i,n,h,s){var r=this.De(t,i);if("left"!==s){var u=Ji(t.canvas);n-=Math.floor(r.Te*u)}h-=Math.floor(r.us/2),t.drawImage(r.Le,n,h,r.es,r.us)},t.prototype.De=function(t,i){var n,h=this;if(this.Se.has(i))n=a(this.Se.get(i));else{if(this.Gh.length>=200){var s=a(this.Gh.shift());this.Se.delete(s)}var r=Ji(t.canvas),u=Math.ceil(this.Xn/4.5),e=Math.round(this.Xn/10),o=Math.ceil(this.ns.measureText(t,i)),f=it(Math.round(o+2*u)),l=it(this.Xn+2*u),c=Qi(document,new Zi(f,l));n={_s:i,Te:Math.round(Math.max(1,o)),es:Math.ceil(f*r),us:Math.ceil(l*r),Le:c},0!==o&&(this.Gh.push(n._s),this.Se.set(n._s,n)),V(t=Gi(n.Le),r,(function(){t.font=h.cs,t.fillStyle=h.Ne,t.fillText(i,0,l-u-e)}))}return n},t}(),ln=function(){function t(t,i,n,h){var s=this;this.st=null,this.Ee=null,this.Be=null,this.Ae=!1,this.Oe=null,this.Ve="",this.Pe=new oi(50),this.ze=new fn(11,"#000"),this.Ne=null,this.cs=null,this.Fe=0,this.Ie=function(){s.We(s.ou.options()),s.lt.je().Re().lightUpdate()},this.Ue=function(){s.lt.je().Re().lightUpdate()},this.lt=t,this.kt=i,this.ou=n,this.qe="left"===h,this.He=document.createElement("div"),this.He.style.height="100%",this.He.style.overflow="hidden",this.He.style.width="25px",this.He.style.left="0",this.He.style.position="relative",this.Ye=tn(this.He,new Zi(16,16)),this.Ye.subscribeCanvasConfigured(this.Ie);var r=this.Ye.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Ke=tn(this.He,new Zi(16,16)),this.Ke.subscribeCanvasConfigured(this.Ue);var u=this.Ke.canvas;u.style.position="absolute",u.style.zIndex="2",u.style.left="0",u.style.top="0";var e={ju:this.$e.bind(this),ne:this.Xe.bind(this),$u:this.Ze.bind(this),he:this.Je.bind(this),Ju:this.Ge.bind(this),Gu:this.Qe.bind(this),Ru:this.io.bind(this),le:this.no.bind(this)};this.ho=new rn(this.Ke.canvas,e,{Yu:!1,Ku:!0})}return t.prototype.destroy=function(){this.ho.destroy(),this.Ke.unsubscribeCanvasConfigured(this.Ue),this.Ke.destroy(),this.Ye.unsubscribeCanvasConfigured(this.Ie),this.Ye.destroy(),null!==this.st&&this.st.onMarksChanged().unsubscribeAll(this),this.st=null,null!==this.Be&&(clearTimeout(this.Be),this.Be=null),this.ze.destroy()},t.prototype.so=function(){return this.He},t.prototype.ro=function(){return this.kt.backgroundColor},t.prototype.g=function(){return f(this.st).options().borderColor},t.prototype.uo=function(){return this.kt.textColor},t.prototype.eo=function(){return this.kt.fontSize},t.prototype.oo=function(){return Vt(this.eo(),this.kt.fontFamily)},t.prototype.ao=function(){var t=this.ou.options(),i=this.Ne!==t.color,n=this.cs!==t.font;return(i||n)&&(this.We(t),this.Ne=t.color),n&&(this.Pe.reset(),this.cs=t.font),t},t.prototype.fo=function(){if(null===this.st)return 0;var t=34,i=this.ao(),n=Gi(this.Ye.canvas),h=this.st.marks();n.font=this.oo(),h.length>0&&(t=Math.max(this.Pe.measureText(n,h[0].label),this.Pe.measureText(n,h[h.length-1].label)));for(var s=this.lo(),r=s.length;r--;){var u=this.Pe.measureText(n,s[r].text());u>t&&(t=u)}var e=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+t);return e+=e%2},t.prototype.co=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Ee&&this.Ee.wu(t)||(this.Ee=t,this.Ye.resizeCanvas({width:t.F,height:t.I}),this.Ke.resizeCanvas({width:t.F,height:t.I}),this.He.style.width=t.F+"px",this.He.style.height=t.I+"px",this.He.style.minWidth=t.F+"px")},t.prototype.vo=function(){return f(this.Ee).F},t.prototype.do=function(t){this.st!==t&&(null!==this.st&&this.st.onMarksChanged().unsubscribeAll(this),this.st=t,t.onMarksChanged().subscribe(this.ci.bind(this),this))},t.prototype._o=function(){return this.st},t.prototype.wo=function(){var t=this.lt.Mo();this.lt.je().Re().resetPriceScale(t,f(this._o()))},t.prototype.bo=function(t){if(null!==this.Ee){if(1!==t){var i=Gi(this.Ye.canvas);this.mo(),this.po(i,this.Ye.pixelRatio),this.Fh(i,this.Ye.pixelRatio),this.yo(i,this.Ye.pixelRatio),this.ko(i,this.Ye.pixelRatio)}var n=Gi(this.Ke.canvas),h=this.Ee.F,s=this.Ee.I;V(n,this.Ke.pixelRatio,(function(){n.clearRect(0,0,h,s)})),this.xo(n,this.Ke.pixelRatio)}},t.prototype.No=function(){return this.Ye.canvas},t.prototype.So=function(){for(var t=[],i=0,n=this.lt.Mo().orderedSources();i<n.length;i++){var h=n[i];h instanceof Fi&&t.push.apply(t,h.customPriceLines().filter((function(t){return t.options().draggable&&t.priceAxisView().isAxisLabelVisible()})))}return t},t.prototype.Co=function(t){for(var i=this.ao(),n=0,h=this.So();n<h.length;n++){var s=h[n],r=s.priceAxisView(),u=r.height(i,!1),e=r.getFixedCoordinate();if(e-u/2<=t&&t<=e+u/2)return s}return null},t.prototype.$e=function(t){null!==this.Co(t.be)?this.Do(2):this.Do(0)},t.prototype.Xe=function(t){if(null!==this.st&&!this.st.isEmpty()){this.Ae=!0;var i=this.Co(t.be);if(i){this.Oe=i;var n=i.options().price,h=f(this.st.firstValue());return this.Ve=this.st.formatPrice(n,h),void this.Do(3)}if(this.lt.je().To().handleScale.axisPressedMouseMove.price){var s=this.lt.je().Re(),r=this.lt.Mo();s.startScalePrice(r,this.st,t.be)}}},t.prototype.Ze=function(t){if(null!==this.st){var i=this.st;if(this.Oe){var n=f(i.firstValue()),h=i.coordinateToPrice(t.be,n);this.Oe.applyOptions({price:h})}else if(this.lt.je().To().handleScale.axisPressedMouseMove.price){var s=this.lt.je().Re(),r=this.lt.Mo();s.scalePriceTo(r,i,t.be)}}},t.prototype.Je=function(){if(null!==this.st&&this.Ae){if(this.Ae=!1,this.Oe=null,this.Ve="",!this.lt.je().To().handleScale.axisPressedMouseMove.price)return;var t=this.lt.je().Re(),i=this.lt.Mo(),n=this.st;t.endScalePrice(i,n)}},t.prototype.Ge=function(t){if(null!==this.st){var i=this.lt.je().Re();if(this.Ae=!1,this.Oe)return i.fireCustomPriceLineDragged(this.Oe,this.Ve),this.Oe=null,this.Ve="",void this.Do(2);if(this.lt.je().To().handleScale.axisPressedMouseMove.price){var n=this.lt.Mo();i.endScalePrice(n,this.st)}}},t.prototype.Qe=function(t){null===this.Co(t.be)&&this.lt.je().To().handleScale.axisDoubleClickReset&&this.wo()},t.prototype.io=function(t){null!==this.st&&(null===this.Oe?null===this.Co(t.be)?!this.lt.je().Re().options().handleScale.axisPressedMouseMove.price||this.st.isPercentage()||this.st.isIndexedTo100()||this.Do(1):this.Do(2):this.Do(3))},t.prototype.no=function(t){this.Do(0)},t.prototype.lo=function(){var t=this,i=[],n=null===this.st?void 0:this.st;return function(h){for(var s=0;s<h.length;++s)for(var r=h[s].priceAxisViews(t.lt.Mo(),n),u=0;u<r.length;u++)i.push(r[u])}(this.lt.Mo().orderedSources()),i},t.prototype.po=function(t,i){var n=this;if(null!==this.Ee){var h=this.Ee.F,s=this.Ee.I;V(t,i,(function(){P(t,0,0,h,s,n.ro())}))}},t.prototype.Fh=function(t,i){if(null!==this.Ee&&null!==this.st&&this.st.options().borderVisible){t.save(),t.fillStyle=this.g();var n,h=Math.max(1,Math.floor(this.ao().borderSize*i));n=this.qe?Math.floor(this.Ee.F*i)-h:0,t.fillRect(n,0,h,Math.ceil(this.Ee.I*i)),t.restore()}},t.prototype.yo=function(t,i){if(null!==this.Ee&&null!==this.st){var n=this.st.marks();t.save(),t.strokeStyle=this.g(),t.font=this.oo(),t.fillStyle=this.g();var h=this.ao(),s=this.st.options().borderVisible&&this.st.options().drawTicks,r=this.qe?Math.floor((this.Ee.F-h.tickLength)*i-h.borderSize*i):Math.floor(h.borderSize*i),u=this.qe?Math.round(r-h.paddingInner*i):Math.round(r+h.tickLength*i+h.paddingInner*i),e=this.qe?"right":"left",o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(s){var f=Math.round(h.tickLength*i);t.beginPath();for(var l=0,c=n;l<c.length;l++){var v=c[l];t.rect(r,Math.round(v.coord*i)-a,f,o)}t.fill()}t.fillStyle=this.uo();for(var d=0,_=n;d<_.length;d++){v=_[d];this.ze.Ce(t,v.label,u,Math.round(v.coord*i),e)}t.restore()}},t.prototype.mo=function(){if(null!==this.Ee&&null!==this.st){var t=this.Ee.I/2,i=[],n=this.st.orderedSources().slice(),h=this.lt.Mo(),s=this.ao();this.st===h.defaultPriceScale()&&this.lt.Mo().orderedSources().forEach((function(t){h.isOverlay(t)&&n.push(t)}));var r=this.st.dataSources()[0],u=this.st;n.forEach((function(n){var s=n.priceAxisViews(h,u);s.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&s.length>0&&(t=s[0].coordinate())}));var e=i.filter((function(i){return i.coordinate()<=t})),o=i.filter((function(i){return i.coordinate()>t}));if(e.sort((function(t,i){return i.coordinate()-t.coordinate()})),e.length&&o.length&&o.push(e[0]),o.sort((function(t,i){return t.coordinate()-i.coordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.st.options().alignLabels){for(var a=1;a<e.length;a++){var f=e[a],l=(v=e[a-1]).height(s,!1);f.coordinate()>(d=v.getFixedCoordinate())-l&&f.setFixedCoordinate(d-l)}for(var c=1;c<o.length;c++){var v,d;f=o[c],l=(v=o[c-1]).height(s,!0);f.coordinate()<(d=v.getFixedCoordinate())+l&&f.setFixedCoordinate(d+l)}}}},t.prototype.ko=function(t,i){var n=this;if(null!==this.Ee){t.save();var h=this.Ee,s=this.lo(),r=this.ao(),u=this.qe?"right":"left";s.forEach((function(s){if(s.isAxisLabelVisible()){var e=s.renderer(f(n.st));t.save(),e.draw(t,r,n.Pe,h.F,u,i),t.restore()}})),t.restore()}},t.prototype.xo=function(t,i){var n=this;if(null!==this.Ee&&null!==this.st){t.save();var h=this.Ee,s=this.lt.je().Re(),r=[],u=this.lt.Mo(),e=s.crosshairSource().priceAxisViews(u,this.st);e.length&&r.push(e);var o=this.ao(),a=this.qe?"right":"left";r.forEach((function(s){s.forEach((function(s){t.save(),s.renderer(f(n.st)).draw(t,o,n.Pe,h.F,a,i),t.restore()}))})),t.restore()}},t.prototype.Do=function(t){var i="default";1===t?i="ns-resize":2===t?i="grab":3===t&&(i="grabbing"),this.He.style.cursor=i},t.prototype.ci=function(){var t=this,i=this.fo();if(this.Fe<i){var n=this.lt.je();null===this.Be&&(this.Be=setTimeout((function(){n&&n.Re().fullUpdate(),t.Be=null}),100))}this.Fe=i},t.prototype.We=function(t){this.ze.destroy(),this.ze=new fn(t.fontSize,t.color,t.fontFamily)},t}(),cn=sn,vn=function(){function t(t,i){var n=this;this.Ee=new Zi(0,0),this.Lo=null,this.Eo=null,this.Bo=null,this.Ao=!1,this.Oo=new Z,this.Vo=0,this.Po=!1,this.zo=null,this.Fo=!1,this.Io=null,this.Ie=function(){return n.Wo&&n.ot().lightUpdate()},this.Ue=function(){return n.Wo&&n.ot().lightUpdate()},this.Ro=t,this.Wo=i,this.Wo.onDestroyed().subscribe(this.jo.bind(this),this,!0),this.Uo=document.createElement("td"),this.Uo.style.padding="0",this.Uo.style.position="relative";var h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="relative",h.style.overflow="hidden",this.qo=document.createElement("td"),this.qo.style.padding="0",this.Ho=document.createElement("td"),this.Ho.style.padding="0",this.Uo.appendChild(h),this.Ye=tn(h,new Zi(16,16)),this.Ye.subscribeCanvasConfigured(this.Ie);var s=this.Ye.canvas;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Ke=tn(h,new Zi(16,16)),this.Ke.subscribeCanvasConfigured(this.Ue);var r=this.Ke.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Yo=document.createElement("tr"),this.Yo.appendChild(this.qo),this.Yo.appendChild(this.Uo),this.Yo.appendChild(this.Ho),this.Ko();var u=this.je().To().handleScroll;this.ho=new rn(this.Ke.canvas,this,{Yu:!u.vertTouchDrag,Ku:!u.horzTouchDrag})}return t.prototype.destroy=function(){null!==this.Lo&&this.Lo.destroy(),null!==this.Eo&&this.Eo.destroy(),this.Ke.unsubscribeCanvasConfigured(this.Ue),this.Ke.destroy(),this.Ye.unsubscribeCanvasConfigured(this.Ie),this.Ye.destroy(),null!==this.Wo&&this.Wo.onDestroyed().unsubscribeAll(this),this.ho.destroy()},t.prototype.Mo=function(){return f(this.Wo)},t.prototype.$o=function(i){null!==this.Wo&&this.Wo.onDestroyed().unsubscribeAll(this),this.Wo=i,null!==this.Wo&&this.Wo.onDestroyed().subscribe(t.prototype.jo.bind(this),this,!0),this.Ko()},t.prototype.je=function(){return this.Ro},t.prototype.so=function(){return this.Yo},t.prototype.Ko=function(){if(null!==this.Wo&&(this.Xo(),0!==this.ot().serieses().length)){if(null!==this.Lo){var t=this.Wo.leftPriceScale();this.Lo.do(f(t))}if(null!==this.Eo){var i=this.Wo.rightPriceScale();this.Eo.do(f(i))}}},t.prototype.Zo=function(){return null!==this.Wo?this.Wo.stretchFactor():0},t.prototype.Jo=function(t){this.Wo&&this.Wo.setStretchFactor(t)},t.prototype.Ru=function(t){if(this.Wo){var i=t.Me,n=t.be;hn||this.Go(i,n)}},t.prototype.ne=function(t){if(this.Po=!1,this.Fo=null!==this.zo,this.Wo){if(document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{var i=document.getSelection();null!==i&&i.removeAllRanges()}var n=this.ot();if(!this.Wo.defaultPriceScale().isEmpty()&&!n.timeScale().isEmpty()){if(null!==this.zo){var h=n.crosshairSource();this.Io={x:h.appliedX(),y:h.appliedY()},this.zo={x:t.Me,y:t.be}}hn||this.Go(t.Me,t.be)}}},t.prototype.ju=function(t){if(this.Wo){var i=t.Me,n=t.be;if(this.Qo()&&this.ta(),!hn){this.Go(i,n);var h=this.ia(i,n);this.ot().setHoveredSource(h&&{source:h.na,object:h.ha}),null!==h&&void 0!==h.xe.moveHandler&&h.xe.moveHandler(i,n)}}},t.prototype.Qu=function(t){if(null!==this.Wo){var i=t.Me,n=t.be,h=this.ia(i,n);if(null!==h&&void 0!==h.xe.clickHandler&&h.xe.clickHandler(i,n),this.Oo.jt()){var s=this.ot().crosshairSource().appliedIndex();this.Oo.Rt(s,{x:i,y:n})}this.sa()}},t.prototype.$u=function(t){if(null!==this.Wo){var i=this.ot(),n=t.Me,h=t.be;if(null!==this.zo){this.Fo=!1;var s=f(this.Io),r=s.x+(n-this.zo.x),u=s.y+(h-this.zo.y);this.Go(r,u)}else this.Qo()||this.Go(n,h);if(!i.timeScale().isEmpty()){var e=this.Ro.To().handleScroll;if(e.pressedMouseMove&&"touch"!==t.ke||(e.horzTouchDrag||e.vertTouchDrag)&&"mouse"!==t.ke){var o=this.Wo.defaultPriceScale();null!==this.Bo||this.ra()||(this.Bo={x:t.ve,y:t.de}),null===this.Bo||this.Bo.x===t.ve&&this.Bo.y===t.de||this.Ao||(o.isEmpty()||i.startScrollPrice(this.Wo,o,t.be),i.startScrollTime(t.Me),this.Ao=!0),this.Ao&&(o.isEmpty()||i.scrollPriceTo(this.Wo,o,t.be),i.scrollTimeTo(t.Me))}}}},t.prototype.Ju=function(t){if(null!==this.Wo){this.Po=!1;var i=this.ot();if(this.Ao){var n=this.Wo.defaultPriceScale();i.endScrollPrice(this.Wo,n),i.endScrollTime(),this.Bo=null,this.Ao=!1}}},t.prototype.ce=function(t){if(this.Po=!0,null===this.zo&&cn){var i={x:t.Me,y:t.be};this.ua(i,i)}},t.prototype.le=function(t){null!==this.Wo&&(this.Wo.model().setHoveredSource(null),sn||this.ta())},t.prototype.ea=function(){return this.Oo},t.prototype.re=function(){this.Vo=1},t.prototype.ue=function(t,i){if(this.Ro.To().handleScale.pinch){var n=5*(i-this.Vo);this.Vo=i,this.ot().zoomTime(t.V,n)}},t.prototype.ia=function(t,i){var n=this.Wo;if(null===n)return null;for(var h=0,s=n.orderedSources();h<s.length;h++){var r=s[h],u=this.oa(r.paneViews(n),t,i);if(null!==u)return{na:r,xe:u.xe,ha:u.ha}}return null},t.prototype.aa=function(t,i){f("left"===i?this.Lo:this.Eo).co(new Zi(t,this.Ee.I))},t.prototype.fa=function(){return this.Ee},t.prototype.co=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Ee.wu(t)||(this.Ee=t,this.Ye.resizeCanvas({width:t.F,height:t.I}),this.Ke.resizeCanvas({width:t.F,height:t.I}),this.Uo.style.width=t.F+"px",this.Uo.style.height=t.I+"px")},t.prototype.la=function(){var t=f(this.Wo);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var h=n[i];if(t.isOverlay(h)){var s=h.priceScale();null!==s&&t.recalculatePriceScale(s),h.updateAllViews()}}},t.prototype.No=function(){return this.Ye.canvas},t.prototype.bo=function(t){if(0!==t&&null!==this.Wo){if(t>1&&this.la(),null!==this.Lo&&this.Lo.bo(t),null!==this.Eo&&this.Eo.bo(t),1!==t){var i=Gi(this.Ye.canvas);i.save(),this.po(i,this.ca(),this.Ye.pixelRatio),this.Wo&&(this.va(i,this.Ye.pixelRatio),this.da(i,this.Ye.pixelRatio),this._a(i,this.Ye.pixelRatio)),i.restore()}var n=Gi(this.Ke.canvas);n.clearRect(0,0,Math.ceil(this.Ee.F*this.Ke.pixelRatio),Math.ceil(this.Ee.I*this.Ke.pixelRatio)),this.wa(n,this.Ke.pixelRatio)}},t.prototype.Ma=function(){return this.Lo},t.prototype.ba=function(){return this.Eo},t.prototype.ca=function(){return this.Ro.To().layout.backgroundColor},t.prototype.jo=function(){null!==this.Wo&&this.Wo.onDestroyed().unsubscribeAll(this),this.Wo=null},t.prototype.po=function(t,i,n){var h=this;V(t,n,(function(){P(t,0,0,h.Ee.F,h.Ee.I,i)}))},t.prototype.va=function(t,i){var n=f(this.Wo),h=n.grid().paneView().renderer(n.height(),n.width());null!==h&&(t.save(),h.draw(t,i,!1),t.restore())},t.prototype.da=function(t,i){var n=this.ot().watermarkSource();this.ma(n,t,i),this.ga(n,t,i)},t.prototype.wa=function(t,i){this.ga(this.ot().crosshairSource(),t,i)},t.prototype._a=function(t,i){for(var n=f(this.Wo).orderedSources(),h=0,s=n;h<s.length;h++){var r=s[h];this.ma(r,t,i)}for(var u=0,e=n;u<e.length;u++){r=e[u];this.ga(r,t,i)}},t.prototype.ga=function(t,i,n){for(var h=f(this.Wo),s=t.paneViews(h),r=h.height(),u=h.width(),e=h.model().hoveredSource(),o=null!==e&&e.source===t,a=null!==e&&o&&void 0!==e.object?e.object.hitTestData:void 0,l=0,c=s;l<c.length;l++){var v=c[l].renderer(r,u);null!==v&&(i.save(),v.draw(i,n,o,a),i.restore())}},t.prototype.ma=function(t,i,n){for(var h=f(this.Wo),s=t.paneViews(h),r=h.height(),u=h.width(),e=h.model().hoveredSource(),o=null!==e&&e.source===t,a=null!==e&&o&&void 0!==e.object?e.object.hitTestData:void 0,l=0,c=s;l<c.length;l++){var v=c[l].renderer(r,u);null!==v&&void 0!==v.drawBackground&&(i.save(),v.drawBackground(i,n,o,a),i.restore())}},t.prototype.oa=function(t,i,n){for(var h=0,s=t;h<s.length;h++){var r=s[h],u=r.renderer(this.Ee.I,this.Ee.F);if(null!==u&&u.hitTest){var e=u.hitTest(i,n);if(null!==e)return{xe:r,ha:e}}}return null},t.prototype.Xo=function(){if(null!==this.Wo){var t=this.Ro;t.To().leftPriceScale.visible||null===this.Lo||(this.qo.removeChild(this.Lo.so()),this.Lo.destroy(),this.Lo=null),t.To().rightPriceScale.visible||null===this.Eo||(this.Ho.removeChild(this.Eo.so()),this.Eo.destroy(),this.Eo=null);var i=t.Re().rendererOptionsProvider();t.To().leftPriceScale.visible&&null===this.Lo&&(this.Lo=new ln(this,t.To().layout,i,"left"),this.qo.appendChild(this.Lo.so())),t.To().rightPriceScale.visible&&null===this.Eo&&(this.Eo=new ln(this,t.To().layout,i,"right"),this.Ho.appendChild(this.Eo.so()))}},t.prototype.Qo=function(){return cn&&null===this.zo},t.prototype.ra=function(){return cn&&this.Po||null!==this.zo},t.prototype.pa=function(t){return Math.max(0,Math.min(t,this.Ee.F-1))},t.prototype.ya=function(t){return Math.max(0,Math.min(t,this.Ee.I-1))},t.prototype.Go=function(t,i){this.ot().setAndSaveCurrentPosition(this.pa(t),this.ya(i),f(this.Wo))},t.prototype.ka=function(t,i){this.ot().setAndSaveCurrentPosition(this.pa(t),this.ya(i),f(this.Wo))},t.prototype.ta=function(){this.ot().clearCurrentPosition()},t.prototype.xa=function(t,i,n){if(this.Wo)if(n){var h=t,s=i;hn||this.Na(h,s)}else this.Wo.model().setHoveredSource(null),sn||this.ta()},t.prototype.Na=function(t,i){this.ot().setAndSaveCurrentPositionFire(this.pa(t),this.ya(i),!1,f(this.Wo))},t.prototype.Sa=function(){this.ta()},t.prototype.sa=function(){this.Fo&&(this.zo=null,this.ta())},t.prototype.ua=function(t,i){this.zo=t,this.Fo=!1,this.Go(i.x,i.y);var n=this.ot().crosshairSource();this.Io={x:n.appliedX(),y:n.appliedY()}},t.prototype.ot=function(){return this.Ro.Re()},t}(),dn=function(){function t(t,i,n,h){var s=this;this.S=!0,this.Ee=new Zi(0,0),this.Ie=function(){return s.bo(3)},this.qe="left"===t,this.ou=n.Ca,this.kt=i,this.Da=h,this.He=document.createElement("div"),this.He.style.width="25px",this.He.style.height="100%",this.He.style.overflow="hidden",this.Ye=tn(this.He,new Zi(16,16)),this.Ye.subscribeCanvasConfigured(this.Ie)}return t.prototype.destroy=function(){this.Ye.unsubscribeCanvasConfigured(this.Ie),this.Ye.destroy()},t.prototype.so=function(){return this.He},t.prototype.fa=function(){return this.Ee},t.prototype.co=function(t){if(t.F<0||t.I<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Ee.wu(t)||(this.Ee=t,this.Ye.resizeCanvas({width:t.F,height:t.I}),this.He.style.width=t.F+"px",this.He.style.minWidth=t.F+"px",this.He.style.height=t.I+"px",this.S=!0)},t.prototype.bo=function(t){if((!(t<3)||this.S)&&0!==this.Ee.F&&0!==this.Ee.I){this.S=!1;var i=Gi(this.Ye.canvas);this.po(i,this.Ye.pixelRatio),this.Fh(i,this.Ye.pixelRatio)}},t.prototype.No=function(){return this.Ye.canvas},t.prototype.Fh=function(t,i){if(this.Da()){var n=this.Ee.F;t.save(),t.fillStyle=this.kt.timeScale.borderColor;var h=Math.floor(this.ou.options().borderSize*i),s=this.qe?Math.round(n*i)-h:0;t.fillRect(s,0,h,h),t.restore()}},t.prototype.po=function(t,i){var n=this;V(t,i,(function(){P(t,0,0,n.Ee.F,n.Ee.I,n.kt.layout.backgroundColor)}))},t}();function _n(t,i){return t.weight>i.weight?t:i}var wn=function(){function t(t){var i=this;this.Ta=null,this.La=null,this.$n=null,this.Ea=!1,this.Ee=new Zi(0,0),this.Ie=function(){return i.Ro.Re().lightUpdate()},this.Ue=function(){return i.Ro.Re().lightUpdate()},this.Ro=t,this.kt=t.To().layout,this.Ba=document.createElement("tr"),this.Aa=document.createElement("td"),this.Aa.style.padding="0",this.Oa=document.createElement("td"),this.Oa.style.padding="0",this.He=document.createElement("td"),this.He.style.height="25px",this.He.style.padding="0",this.Va=document.createElement("div"),this.Va.style.width="100%",this.Va.style.height="100%",this.Va.style.position="relative",this.Va.style.overflow="hidden",this.He.appendChild(this.Va),this.Ye=tn(this.Va,new Zi(16,16)),this.Ye.subscribeCanvasConfigured(this.Ie);var n=this.Ye.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Ke=tn(this.Va,new Zi(16,16)),this.Ke.subscribeCanvasConfigured(this.Ue);var h=this.Ke.canvas;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this.Ba.appendChild(this.Aa),this.Ba.appendChild(this.He),this.Ba.appendChild(this.Oa),this.Pa(),this.Ro.Re().priceScalesOptionsChanged().subscribe(this.Pa.bind(this),this),this.ho=new rn(this.Ke.canvas,this,{Yu:!0,Ku:!1})}return t.prototype.destroy=function(){this.ho.destroy(),null!==this.Ta&&this.Ta.destroy(),null!==this.La&&this.La.destroy(),this.Ke.unsubscribeCanvasConfigured(this.Ue),this.Ke.destroy(),this.Ye.unsubscribeCanvasConfigured(this.Ie),this.Ye.destroy()},t.prototype.so=function(){return this.Ba},t.prototype.za=function(){return this.Ta},t.prototype.Fa=function(){return this.La},t.prototype.ne=function(t){if(!this.Ea){this.Ea=!0;var i=this.Ro.Re();!i.timeScale().isEmpty()&&this.Ro.To().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.Me)}},t.prototype.he=function(){var t=this.Ro.Re();!t.timeScale().isEmpty()&&this.Ea&&(this.Ea=!1,this.Ro.To().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.$u=function(t){var i=this.Ro.Re();!i.timeScale().isEmpty()&&this.Ro.To().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.Me)},t.prototype.Ju=function(t){this.Ea=!1;var i=this.Ro.Re();i.timeScale().isEmpty()&&!this.Ro.To().handleScale.axisPressedMouseMove.time||i.endScaleTime()},t.prototype.Gu=function(){this.Ro.To().handleScale.axisDoubleClickReset&&this.Ro.Re().resetTimeScale()},t.prototype.Ru=function(t){this.Ro.Re().options().handleScale.axisPressedMouseMove.time&&this.Do(1)},t.prototype.le=function(t){this.Do(0)},t.prototype.fa=function(){return this.Ee},t.prototype.Ia=function(t,i,n){this.Ee&&this.Ee.wu(t)||(this.Ee=t,this.Ye.resizeCanvas({width:t.F,height:t.I}),this.Ke.resizeCanvas({width:t.F,height:t.I}),this.He.style.width=t.F+"px",this.He.style.height=t.I+"px"),null!==this.Ta&&this.Ta.co(new Zi(i,t.I)),null!==this.La&&this.La.co(new Zi(n,t.I))},t.prototype.Wa=function(){var t=this.Ra();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.Y=function(){this.Ro.Re().timeScale().marks()},t.prototype.No=function(){return this.Ye.canvas},t.prototype.bo=function(t){if(0!==t){if(1!==t){var i=Gi(this.Ye.canvas);this.po(i,this.Ye.pixelRatio),this.Fh(i,this.Ye.pixelRatio),this.yo(i,this.Ye.pixelRatio),null!==this.Ta&&this.Ta.bo(t),null!==this.La&&this.La.bo(t)}var n=Gi(this.Ke.canvas),h=this.Ke.pixelRatio;n.clearRect(0,0,Math.ceil(this.Ee.F*h),Math.ceil(this.Ee.I*h)),this.ja([this.Ro.Re().crosshairSource()],n,h)}},t.prototype.po=function(t,i){var n=this;V(t,i,(function(){P(t,0,0,n.Ee.F,n.Ee.I,n.ca())}))},t.prototype.Fh=function(t,i){if(this.Ro.To().timeScale.borderVisible){t.save(),t.fillStyle=this.Ua();var n=Math.max(1,Math.floor(this.Ra().borderSize*i));t.fillRect(0,0,Math.ceil(this.Ee.F*i),n),t.restore()}},t.prototype.yo=function(t,i){var n=this,h=this.Ro.Re().timeScale().marks();if(h&&0!==h.length){var s=h.reduce(_n,h[0]).weight;s>30&&s<40&&(s=30),t.save(),t.strokeStyle=this.Ua();var r=this.Ra(),u=r.borderSize+r.tickLength+r.paddingTop+r.fontSize-r.baselineOffset;t.textAlign="center",t.fillStyle=this.Ua();var e=Math.floor(this.Ra().borderSize*i),o=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(this.Ro.Re().timeScale().options().borderVisible){t.beginPath();for(var f=Math.round(r.tickLength*i),l=h.length;l--;){var c=Math.round(h[l].coord*i);t.rect(c-a,e,o,f)}t.fill()}t.fillStyle=this.Jn(),V(t,i,(function(){t.font=n.qa();for(var i=0,r=h;i<r.length;i++){(a=r[i]).weight<s&&t.fillText(a.label,a.coord,u)}t.font=n.Ha();for(var e=0,o=h;e<o.length;e++){var a;(a=o[e]).weight>=s&&t.fillText(a.label,a.coord,u)}}))}},t.prototype.ja=function(t,i,n){for(var h=this.Ra(),s=0,r=t;s<r.length;s++)for(var u=0,e=r[s].timeAxisViews();u<e.length;u++){var o=e[u];i.save(),o.renderer().draw(i,h,n),i.restore()}},t.prototype.ca=function(){return this.kt.backgroundColor},t.prototype.Ua=function(){return this.Ro.To().timeScale.borderColor},t.prototype.Jn=function(){return this.kt.textColor},t.prototype.Xn=function(){return this.kt.fontSize},t.prototype.qa=function(){return Vt(this.Xn(),this.kt.fontFamily)},t.prototype.Ha=function(){return Vt(this.Xn(),this.kt.fontFamily,"bold")},t.prototype.Ra=function(){null===this.$n&&(this.$n={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new oi});var t=this.$n,i=this.qa();if(t.font!==i){var n=this.Xn();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.Xn()/5),t.widthCache.reset()}return this.$n},t.prototype.Do=function(t){this.He.style.cursor=1===t?"ew-resize":"default"},t.prototype.Pa=function(){var t=this.Ro.Re(),i=t.options();i.leftPriceScale.visible||null===this.Ta||(this.Aa.removeChild(this.Ta.so()),this.Ta.destroy(),this.Ta=null),i.rightPriceScale.visible||null===this.La||(this.Oa.removeChild(this.La.so()),this.La.destroy(),this.La=null);var n={Ca:this.Ro.Re().rendererOptionsProvider()};if(i.leftPriceScale.visible&&null===this.Ta){var h=function(){return i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible};this.Ta=new dn("left",this.Ro.To(),n,h),this.Aa.appendChild(this.Ta.so())}if(i.rightPriceScale.visible&&null===this.La){h=function(){return i.rightPriceScale.borderVisible&&t.timeScale().options().borderVisible};this.La=new dn("right",this.Ro.To(),n,h),this.Oa.appendChild(this.La.so())}},t}(),Mn=function(){function t(t,i){var n;this.Ya=[],this.Ka=0,this.hi=0,this.ln=0,this.$a=0,this.Xa=0,this.Za=null,this.Ja=!1,this.Oo=new Z,this.ru=new Z,this.uu=new Z,this.kt=i,this.Ba=document.createElement("div"),this.Ba.classList.add("tv-lightweight-charts"),this.Ba.style.overflow="hidden",this.Ba.style.width="100%",this.Ba.style.height="100%",(n=this.Ba).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.Ga=document.createElement("table"),this.Ga.setAttribute("cellspacing","0"),this.Ba.appendChild(this.Ga),this.Qa=this.tf.bind(this),this.Ba.addEventListener("wheel",this.Qa,{passive:!1}),this.ot=new Ki(this.eu.bind(this),this.kt),this.Re().crosshairMoved().subscribe(this.if.bind(this),this),this.Re().customPriceLineDragged().subscribe(this.nf.bind(this),this),this.hf=new wn(this),this.Ga.appendChild(this.hf.so());var h=this.kt.width,s=this.kt.height;if(0===h||0===s){var r=t.getBoundingClientRect();0===h&&(h=Math.floor(r.width),h-=h%2),0===s&&(s=Math.floor(r.height),s-=s%2)}this.sf(h,s),this.rf(),t.appendChild(this.Ba),this.uf(),this.ot.timeScale().optionsApplied().subscribe(this.ot.fullUpdate.bind(this.ot),this),this.ot.priceScalesOptionsChanged().subscribe(this.ot.fullUpdate.bind(this.ot),this)}return t.prototype.Re=function(){return this.ot},t.prototype.To=function(){return this.kt},t.prototype.ef=function(){return this.Ya},t.prototype.destroy=function(){this.Ba.removeEventListener("wheel",this.Qa),0!==this.Ka&&window.cancelAnimationFrame(this.Ka),this.ot.crosshairMoved().unsubscribeAll(this),this.ot.customPriceLineDragged().unsubscribeAll(this),this.ot.timeScale().optionsApplied().unsubscribeAll(this),this.ot.priceScalesOptionsChanged().unsubscribeAll(this),this.ot.destroy();for(var t=0,i=this.Ya;t<i.length;t++){var n=i[t];this.Ga.removeChild(n.so()),n.ea().unsubscribeAll(this),n.destroy()}this.Ya=[],f(this.hf).destroy(),null!==this.Ba.parentElement&&this.Ba.parentElement.removeChild(this.Ba),this.ru.Ut(),this.Oo.Ut()},t.prototype.sf=function(t,i,n){if(void 0===n&&(n=!1),this.hi!==i||this.ln!==t){this.hi=i,this.ln=t;var h=i+"px",s=t+"px";f(this.Ba).style.height=h,f(this.Ba).style.width=s,this.Ga.style.height=h,this.Ga.style.width=s,n?this.af(new Ft(3)):this.ot.fullUpdate()}},t.prototype.bo=function(t){void 0===t&&(t=new Ft(3));for(var i=0;i<this.Ya.length;i++)this.Ya[i].bo(t.invalidateForPane(i).level);this.hf.bo(t.fullInvalidation())},t.prototype.ff=function(t){this.ot.applyOptions(t),this.uf();var i=t.width||this.ln,n=t.height||this.hi;this.sf(i,n)},t.prototype.ea=function(){return this.Oo},t.prototype.lf=function(){return this.ru},t.prototype.cf=function(){return this.uu},t.prototype.vf=function(){var t=this;null!==this.Za&&(this.af(this.Za),this.Za=null);var i=this.Ya[0],n=Qi(document,new Zi(this.ln,this.hi)),h=Gi(n),s=Ji(n);return V(h,s,(function(){var n=0,s=0,r=function(i){for(var r=0;r<t.Ya.length;r++){var u=t.Ya[r],e=u.fa().I,o=f("left"===i?u.Ma():u.ba()),a=o.No();h.drawImage(a,n,s,o.vo(),e),s+=e}};t.df()&&(r("left"),n=f(i.Ma()).vo()),s=0;for(var u=0;u<t.Ya.length;u++){var e=t.Ya[u],o=e.fa(),a=e.No();h.drawImage(a,n,s,o.F,o.I),s+=o.I}n+=i.fa().F,t._f()&&(s=0,r("right"));var l=function(i){var r=f("left"===i?t.hf.za():t.hf.Fa()),u=r.fa(),e=r.No();h.drawImage(e,n,s,u.F,u.I)};if(t.kt.timeScale.visible){n=0,t.df()&&(l("left"),n=f(i.Ma()).vo());var c=t.hf.fa();a=t.hf.No();h.drawImage(a,n,s,c.F,c.I),t._f()&&(n=i.fa().F,l("right"),h.restore())}})),n},t.prototype.wf=function(t){return"none"===t?0:("left"!==t||this.df())&&("right"!==t||this._f())?0===this.Ya.length?0:f("left"===t?this.Ya[0].Ma():this.Ya[0].ba()).vo():0},t.prototype.Mf=function(){for(var t=0,i=0,n=0,h=0,s=this.Ya;h<s.length;h++){var r=s[h];this.df()&&(i=Math.max(i,f(r.Ma()).fo())),this._f()&&(n=Math.max(n,f(r.ba()).fo())),t+=r.Zo()}var u=this.ln,e=this.hi,o=Math.max(u-i-n,0),a=this.kt.timeScale.visible?this.hf.Wa():0;a%2&&(a+=1);for(var l=0+a,c=e<l?0:e-l,v=c/t,d=0,_=0;_<this.Ya.length;++_){(r=this.Ya[_]).$o(this.ot.panes()[_]);var w,M=0;M=_===this.Ya.length-1?c-d:Math.round(r.Zo()*v),d+=w=Math.max(M,2),r.co(new Zi(o,w)),this.df()&&r.aa(i,"left"),this._f()&&r.aa(n,"right"),r.Mo()&&this.ot.setPaneHeight(r.Mo(),w)}this.hf.Ia(new Zi(o,a),i,n),this.ot.setWidth(o),this.$a!==i&&(this.$a=i),this.Xa!==n&&(this.Xa=n)},t.prototype.tf=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.kt.handleScroll.mouseWheel||0!==n&&this.kt.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.kt.handleScale.mouseWheel){var h=Math.sign(n)*Math.min(1,Math.abs(n)),s=t.clientX-this.Ba.getBoundingClientRect().left;this.Re().zoomTime(s,h)}0!==i&&this.kt.handleScroll.mouseWheel&&this.Re().scrollChart(-80*i)}},t.prototype.af=function(t){var i=t.fullInvalidation();if(3===i&&this.bf(),3===i||2===i){for(var n=this.ot.panes(),h=0;h<n.length;h++)t.invalidateForPane(h).autoScale&&n[h].momentaryAutoScale();for(var s=t.timeScaleInvalidations(),r=0,u=s;r<u.length;r++){var e=u[r];this.nh(e)}s.length>0&&(this.ot.recalculateAllPanes(),this.ot.updateCrosshair(),this.ot.lightUpdate()),this.hf.Y()}this.bo(t)},t.prototype.nh=function(t){var i=this.ot.timeScale();switch(t.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(t.value);break;case 2:i.setBarSpacing(t.value);break;case 3:i.setRightOffset(t.value);break;case 4:i.restoreDefault()}},t.prototype.eu=function(t){var i=this;null!==this.Za?this.Za.merge(t):this.Za=t,this.Ja||(this.Ja=!0,this.Ka=window.requestAnimationFrame((function(){i.Ja=!1,i.Ka=0,null!==i.Za&&(i.af(i.Za),i.Za=null)})))},t.prototype.bf=function(){this.rf()},t.prototype.rf=function(){for(var t=this.ot.panes(),i=t.length,n=this.Ya.length,h=i;h<n;h++){var s=a(this.Ya.pop());this.Ga.removeChild(s.so()),s.ea().unsubscribeAll(this),s.destroy()}for(h=n;h<i;h++){(s=new vn(this,t[h])).ea().subscribe(this.mf.bind(this),this),this.Ya.push(s),this.Ga.insertBefore(s.so(),this.hf.so())}for(h=0;h<i;h++){var r=t[h];(s=this.Ya[h]).Mo()!==r?s.$o(r):s.Ko()}this.uf(),this.Mf()},t.prototype.gf=function(t,i){var n,h=new Map;null!==t&&this.ot.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&h.set(i,n)}));if(null!==t){var s=this.ot.timeScale().indexToTime(t);null!==s&&(n=s)}var r=this.Re().hoveredSource(),u=null!==r&&r.source instanceof Fi?r.source:void 0,e=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{at:n,pf:i||void 0,yf:u,kf:h,xf:e}},t.prototype.Nf=function(t,i){return{Sf:t,Cf:i}},t.prototype.mf=function(t,i){var n=this;this.Oo.Rt((function(){return n.gf(t,i)}))},t.prototype.if=function(t,i){var n=this;this.ru.Rt((function(){return n.gf(t,i)}))},t.prototype.nf=function(t,i){var n=this;this.uu.Rt((function(){return n.Nf(t,i)}))},t.prototype.uf=function(){var t=this.kt.timeScale.visible?"":"none";this.hf.so().style.display=t},t.prototype.df=function(){return this.kt.leftPriceScale.visible},t.prototype._f=function(){return this.kt.rightPriceScale.visible},t}();function bn(t,i,n){var h=n.value,s={index:i,time:t,value:[h,h,h,h]};return"color"in n&&void 0!==n.color&&(s.color=n.color),s}function mn(t,i,n){return{index:i,time:t,value:[n.open,n.high,n.low,n.close]}}function gn(t){return void 0!==t.value}function pn(t){return function(i,n,h){return void 0===(s=h).open&&void 0===s.value?{time:i,index:n}:t(i,n,h);var s}}var yn={Candlestick:pn(mn),Bar:pn(mn),Area:pn(bn),Histogram:pn(bn),Line:pn(bn)};function kn(t){return yn[t]}function xn(t){return 60*t*60*1e3}function Nn(t){return 60*t*1e3}var Sn,Cn=[{Df:1,Tf:20},{Df:(Sn=1,1e3*Sn),Tf:19},{Df:Nn(1),Tf:20},{Df:Nn(5),Tf:21},{Df:Nn(30),Tf:22},{Df:xn(1),Tf:30},{Df:xn(3),Tf:31},{Df:xn(6),Tf:32},{Df:xn(12),Tf:33}];function Dn(t,i){if(null!==i){var n=new Date(1e3*i),h=new Date(1e3*t);if(h.getUTCFullYear()!==n.getUTCFullYear())return 70;if(h.getUTCMonth()!==n.getUTCMonth())return 60;if(h.getUTCDate()!==n.getUTCDate())return 50;for(var s=Cn.length-1;s>=0;--s)if(Math.floor(n.getTime()/Cn[s].Df)!==Math.floor(h.getTime()/Cn[s].Df))return Cn[s].Tf}return 20}function Tn(t){if(!Bt(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function Ln(t){if(!At(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function En(t){return 0===t.length?null:Bt(t[0].time)?Tn:Ln}function Bn(t){return At(t)?Ln(t):Bt(t)?Tn(t):Tn(An(t))}function An(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function On(t){_(t.time)&&(t.time=An(t.time))}function Vn(t){return{Lf:0,Ef:new Map,Bf:t}}var Pn=function(){function t(){this.Af=new Map,this.Of=new Map,this.Vf=new Map,this.Pf=[]}return t.prototype.Ut=function(){this.Af.clear(),this.Of.clear(),this.Vf.clear(),this.Pf=[]},t.prototype.zf=function(t,i){var n=this;this.Vf.has(t)&&this.Af.forEach((function(i){return i.Ef.delete(t)}));var h=[];if(0!==i.length){!function(t){t.forEach(On)}(i);var s=f(En(i)),r=kn(t.seriesType());h=i.map((function(i){var h=s(i.time),u=n.Af.get(h.timestamp);void 0===u&&(u=Vn(h),n.Af.set(h.timestamp,u));var e=r(h,u.Lf,i);return u.Ef.set(t,e),e}))}return this.Ff(),this.If(t,h),this.Wf(t)},t.prototype.Rf=function(t){return this.zf(t,[])},t.prototype.jf=function(t,i){On(i);var n=f(En([i]))(i.time),h=this.Vf.get(t);if(void 0!==h&&n.timestamp<h.timestamp)throw new Error("Cannot update oldest data, last time="+h.timestamp+", new time="+n.timestamp);var s=this.Af.get(n.timestamp),r=void 0===s;void 0===s&&(s=Vn(n),this.Af.set(n.timestamp,s));var u=kn(t.seriesType())(n,s.Lf,i);s.Ef.set(t,u);var e=this.Uf(t,u);if(!r){var o=new Map;return null!==e&&o.set(t,e),{qf:o,Hf:{Yf:this.Kf()}}}return this.Wf(t)},t.prototype.Uf=function(t,i){var n=this.Of.get(t);void 0===n&&(n=[],this.Of.set(t,n));var h=0!==n.length?n[n.length-1]:null,s=null;return null===h||i.time.timestamp>h.time.timestamp?gn(i)&&(n.push(i),s={$f:!1,Xf:[i]}):gn(i)?(n[n.length-1]=i,s={$f:!1,Xf:[i]}):(n.splice(-1,1),s={$f:!0,Xf:n}),this.Vf.set(t,i.time),s},t.prototype.If=function(t,i){0!==i.length?(this.Of.set(t,i.filter(gn)),this.Vf.set(t,i[i.length-1].time)):(this.Of.delete(t),this.Vf.delete(t))},t.prototype.Ff=function(){var t=new Map;this.Af.forEach((function(i,n){i.Ef.size>0&&t.set(n,i)})),this.Af=t},t.prototype.Zf=function(t){for(var i=-1,n=0;n<this.Pf.length&&n<t.length;++n){var h=this.Pf[n],s=t[n];if(h.time.timestamp!==s.time.timestamp){i=n;break}s.timeWeight=h.timeWeight}if(-1===i&&this.Pf.length!==t.length&&(i=Math.min(this.Pf.length,t.length)),-1===i)return-1;var r=function(i){var n=a(u.Af.get(t[i].time.timestamp));n.Lf=i,n.Ef.forEach((function(t){t.index=i}))},u=this;for(n=i;n<t.length;++n)r(n);return function(t,i){void 0===i&&(i=0);for(var n=0===i||0===t.length?null:t[i-1].time.timestamp,h=0,s=i;s<t.length;++s){var r=t[s];r.timeWeight=Dn(r.time.timestamp,n),h+=r.time.timestamp-(n||r.time.timestamp),n=r.time.timestamp}if(0===i&&t.length>1){var u=Math.ceil(h/(t.length-1)),e=t[0].time.timestamp-u;t[0].timeWeight=Dn(t[0].time.timestamp,e)}}(t,i),this.Pf=t,i},t.prototype.Kf=function(){var t=0;return this.Of.forEach((function(i){0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t},t.prototype.Wf=function(t){var i=Array.from(this.Af.values()).map((function(t){return{timeWeight:0,time:t.Bf}}));i.sort((function(t,i){return t.time.timestamp-i.time.timestamp}));var n=this.Zf(i),h={qf:new Map,Hf:{Yf:this.Kf()}};if(-1!==n)this.Of.forEach((function(t,i){h.qf.set(i,{Xf:t,$f:!0})})),h.Hf.Jf=this.Pf;else{var s=this.Of.get(t);h.qf.set(t,{Xf:s||[],$f:!0})}return h},t}();var zn={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,axisLabelVisible:!0,title:"",draggable:!1},Fn=function(){function t(t){this.Ls=t}return t.prototype.applyOptions=function(t){this.Ls.applyOptions(t)},t.prototype.options=function(){return this.Ls.options()},t.prototype.Gf=function(){return this.Ls},t}();function In(t){var i=t.overlay,n=function(t,i){var n={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&i.indexOf(h)<0&&(n[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(h=Object.getOwnPropertySymbols(t);s<h.length;s++)i.indexOf(h[s])<0&&Object.prototype.propertyIsEnumerable.call(t,h[s])&&(n[h[s]]=t[h[s]])}return n}(t,["overlay"]);return i&&(n.priceScaleId=""),n}var Wn=function(){function t(t,i,n){this.wh=t,this.Qf=i,this.tl=n}return t.prototype.priceFormatter=function(){return this.wh.formatter()},t.prototype.qf=function(){return this.wh},t.prototype.priceToCoordinate=function(t){var i=this.wh.firstValue();return null===i?null:this.wh.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this.wh.firstValue();return null===i?null:this.wh.priceScale().coordinateToPrice(t,i.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var i=new Lt(new St(t.from,t.to)).on(),n=this.wh.bars();if(n.isEmpty())return null;var h=n.search(i.left(),1),s=n.search(i.right(),-1),r=f(n.firstIndex()),u=f(n.lastIndex());if(null!==h&&null!==s&&h.index>s.index)return{barsBefore:t.from-r,barsAfter:u-t.to};var e={barsBefore:null===h||h.index===r?t.from-r:h.index-r,barsAfter:null===s||s.index===u?u-t.to:u-s.index};return null!==h&&null!==s&&(e.from=h.time.businessDay||h.time.timestamp,e.to=s.time.businessDay||s.time.timestamp),e},t.prototype.setData=function(t){this.wh.seriesType(),this.Qf.il(this.wh,t)},t.prototype.update=function(t){this.wh.seriesType(),this.Qf.nl(this.wh,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return u(u({},t),{time:Bn(t.time)})}));this.wh.setMarkers(i)},t.prototype.applyOptions=function(t){var i=In(t);this.wh.applyOptions(i)},t.prototype.options=function(){return M(this.wh.options())},t.prototype.priceScale=function(){return this.tl.priceScale(this.wh.priceScale().id())},t.prototype.createPriceLine=function(t){var i=c(M(zn),t),n=this.wh.createPriceLine(i);return new Fn(n)},t.prototype.removePriceLine=function(t){this.wh.removePriceLine(t.Gf())},t.prototype.seriesType=function(){return this.wh.seriesType()},t}(),Rn=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype.applyOptions=function(i){bt(i),t.prototype.applyOptions.call(this,i)},i}(Wn),jn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2}},Un={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Ot,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},qn={width:0,height:0,layout:{backgroundColor:"#FFFFFF",textColor:"#191919",fontSize:11,fontFamily:Ot},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:u({},jn),leftPriceScale:u(u({},jn),{visible:!1}),rightPriceScale:u(u({},jn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,fixLeftEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:Un,localization:{locale:nn?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0}},Hn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Yn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Kn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},$n={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},Xn={color:"#26a69a",base:0},Zn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},Jn=function(){function t(t,i){this.hl=t,this.sl=i}return t.prototype.applyOptions=function(t){this.hl.Re().applyPriceScaleOptions(this.sl,t)},t.prototype.options=function(){return this.st().options()},t.prototype.width=function(){return zt(this.sl)?this.hl.wf("left"===this.sl?"left":"right"):0},t.prototype.formatPrice=function(t,i){return void 0===i&&(i=0),this.st().formatPrice(t,i)},t.prototype.st=function(){return f(this.hl.Re().findPriceScale(this.sl)).priceScale},t}(),Gn=function(){function t(t){this.rl=new Z,this.mn=new Z,this.ot=t,this.Ar().visibleBarsChanged().subscribe(this.ul.bind(this)),this.Ar().logicalRangeChanged().subscribe(this.el.bind(this))}return t.prototype.destroy=function(){this.Ar().visibleBarsChanged().unsubscribeAll(this),this.Ar().logicalRangeChanged().unsubscribeAll(this),this.rl.Ut()},t.prototype.scrollPosition=function(){return this.Ar().rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.Ar().scrollToOffsetAnimated(t,1e3):this.ot.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.Ar().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,i,n=this.Ar().visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(i=n.to.businessDay)&&void 0!==i?i:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var i={from:Bn(t.from),to:Bn(t.to)},n=this.Ar().logicalRangeForTimeRange(i);this.ot.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this.Ar().visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){o(t.from<=t.to,"The from index cannot be after the to index."),this.ot.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this.ot.resetTimeScale()},t.prototype.fitContent=function(){this.ot.fitContent()},t.prototype.logicalToCoordinate=function(t){var i=this.ot.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){var i=this.ot.timeScale();return i.isEmpty()?null:i.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var i=Bn(t),n=this.ot.timeScale(),h=n.timeToIndex(i,!1);return null===h?null:n.indexToCoordinate(h)},t.prototype.coordinateToTime=function(t){var i,n=this.ot.timeScale(),h=n.coordinateToIndex(t),s=n.indexToTime(h);return null===s?null:null!==(i=s.businessDay)&&void 0!==i?i:s.timestamp},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.rl.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.rl.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this.mn.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this.mn.unsubscribe(t)},t.prototype.applyOptions=function(t){this.Ar().applyOptions(t)},t.prototype.options=function(){return M(this.Ar().options())},t.prototype.Ar=function(){return this.ot.timeScale()},t.prototype.ul=function(){this.rl.jt()&&this.rl.Rt(this.getVisibleRange())},t.prototype.el=function(){this.mn.jt()&&this.mn.Rt(this.getVisibleLogicalRange())},t}();function Qn(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}function th(t){return function(t){if(w(t.handleScale)){var i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&w(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var h=t.handleScroll;w(h)&&(t.handleScroll={horzTouchDrag:h,vertTouchDrag:h,mouseWheel:h,pressedMouseMove:h})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var i=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=c(t.leftPriceScale,t.priceScale),t.rightPriceScale=c(t.rightPriceScale,t.priceScale),"left"===i&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===i&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),t}var ih=function(){function t(t,i){var n=this;this.ol=new Pn,this.al=new Map,this.fl=new Map,this.ll=new Z,this.cl=new Z,this.vl=new Z;var h=void 0===i?M(qn):c(M(qn),th(i));this.hl=new Mn(t,h),this.hl.ea().subscribe((function(t){n.ll.jt()&&n.ll.Rt(n.dl(t()))}),this),this.hl.lf().subscribe((function(t){n.cl.jt()&&n.cl.Rt(n.dl(t()))}),this),this.hl.cf().subscribe((function(t){n.vl.jt()&&n.vl.Rt(n._l(t()))}),this);var s=this.hl.Re();this.wl=new Gn(s)}return t.prototype.setCrossHairXY=function(t,i,n){this.hl.ef()[0].xa(t,i,n)},t.prototype.clearCrossHair=function(){this.hl.ef()[0].Sa()},t.prototype.remove=function(){this.hl.ea().unsubscribeAll(this),this.hl.lf().unsubscribeAll(this),this.hl.cf().unsubscribeAll(this),this.wl.destroy(),this.hl.destroy(),this.al.clear(),this.fl.clear(),this.ll.Ut(),this.cl.Ut(),this.vl.Ut(),this.ol.Ut()},t.prototype.resize=function(t,i,n){this.hl.sf(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Qn((t=In(t)).priceFormat);var i=c(M(Zn),$n,t),n=this.hl.Re().createSeries("Area",i),h=new Wn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Qn((t=In(t)).priceFormat);var i=c(M(Zn),Yn,t),n=this.hl.Re().createSeries("Bar",i),h=new Wn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),bt(t=In(t)),Qn(t.priceFormat);var i=c(M(Zn),Hn,t),n=this.hl.Re().createSeries("Candlestick",i),h=new Rn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Qn((t=In(t)).priceFormat);var i=c(M(Zn),Xn,t),n=this.hl.Re().createSeries("Histogram",i),h=new Wn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Qn((t=In(t)).priceFormat);var i=c(M(Zn),Kn,t),n=this.hl.Re().createSeries("Line",i),h=new Wn(n,this,this);return this.al.set(h,n),this.fl.set(n,h),h},t.prototype.removeSeries=function(t){var i=a(this.al.get(t)),n=this.ol.Rf(i);this.hl.Re().removeSeries(i),this.Ml(n),this.al.delete(t),this.fl.delete(i)},t.prototype.il=function(t,i){this.Ml(this.ol.zf(t,i))},t.prototype.nl=function(t,i){this.Ml(this.ol.jf(t,i))},t.prototype.subscribeClick=function(t){this.ll.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.ll.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this.cl.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.cl.unsubscribe(t)},t.prototype.subscribeCustomPriceLineDragged=function(t){this.vl.subscribe(t)},t.prototype.unsubscribeCustomPriceLineDragged=function(t){this.vl.unsubscribe(t)},t.prototype.priceScale=function(t){return void 0===t&&(t=this.hl.Re().defaultVisiblePriceScaleId()),new Jn(this.hl,t)},t.prototype.timeScale=function(){return this.wl},t.prototype.applyOptions=function(t){this.hl.ff(th(t))},t.prototype.options=function(){return this.hl.To()},t.prototype.takeScreenshot=function(){return this.hl.vf()},t.prototype.Ml=function(t){var i=this.hl.Re();i.updateTimeScale(t.Hf.Yf,t.Hf.Jf),t.qf.forEach((function(t,i){return i.updateData(t.Xf,t.$f)})),i.recalculateAllPanes()},t.prototype.bl=function(t){return a(this.fl.get(t))},t.prototype.dl=function(t){var i=this,n=new Map;t.kf.forEach((function(t,h){n.set(i.bl(h),t)}));var h=void 0===t.yf?void 0:this.bl(t.yf);return{time:t.at&&(t.at.businessDay||t.at.timestamp),point:t.pf,hoveredSeries:h,hoveredMarkerId:t.xf,seriesPrices:n}},t.prototype._l=function(t){return{customPriceLine:t.Sf,fromPriceString:t.Cf}},t}();var nh=Object.freeze({__proto__:null,version:function(){return"3.4.0-dev+202102171116"},get LineStyle(){return i},get LineType(){return t},get CrosshairMode(){return z},get PriceScaleMode(){return ft},get PriceLineSource(){return dt},get TickMarkType(){return Dt},isBusinessDay:Bt,isUTCTimestamp:At,createChart:function(t,i){var n;if(_(t)){var h=document.getElementById(t);o(null!==h,"Cannot find element in DOM with id="+t),n=h}else n=t;return new ih(n,i)}});window.LightweightCharts=nh}();
